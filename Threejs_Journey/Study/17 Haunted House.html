<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link type="text/css" rel="stylesheet" href="./public.css" />
</head>

<body>

    <section class="text js-text">
        <h2>Introduction</h2>
<p>Let's use what we've learned to create a haunted house. We will only use Three.js primitives as geometries, the textures in the <code spellcheck="false">/static/textures/</code> folder, and one or two new features.</p>
<p>We will create an elementary house composed of walls, a roof, a door, and some bushes. We will also produce graves in the garden. Instead of visible ghosts made of sheets, we will simply use multicolor lights floating around and passing through the walls and the floor.</p>
<h2>Tips for measurements</h2>
<p>One beginner mistake we always make when creating something using primitives is using random measures. One unit in Three.js can mean anything you want.</p>
<p>Suppose you are creating a considerable landscape to fly above. In that case, you might think of one unit as one kilometer. If you are building a house, you might think of one unit as one meter, and if you are making a marble game, you might think of one unit as one centimeter.</p>
<p>Having a specific unit ratio will help you create geometries. Let's say you want to make the door. You know that a door is slightly taller than you, so it should reach around 2 meters.</p>
<p>For those using imperials units, you'll have to do the conversion.</p>
<h2>Setup</h2>
<p>The starter is only composed of a floor, a sphere, some lights (way too intense for a haunted house), and shadows aren't even working.</p>
<p>We will have to create the house all by ourselves, tweak the current lights for a better ambiance, add the shadows, and the rest.</p>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-01.png" src="./assets/lessons/17/step-01.png" width="1792" height="1120" alt="./assets/lessons/17/step-01.png" class="is-loaded"></span></p>
<h2>The house</h2>
<p>First, let's remove the sphere and create a tiny house. We can leave the floor.</p>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-02.png" src="./assets/lessons/17/step-02.png" width="1792" height="1120" alt="./assets/lessons/17/step-02.png" class="is-loaded"></span></p>
<p>Instead of putting every object composing that house in the scene, we will first create a container just in case we want to move or scale the whole thing:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// House container</span>
<span class="token keyword">const</span> house <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>house<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Then we can create the walls with a simple cube and add it to the <code spellcheck="false">house</code>. Don't forget to move the walls up on the <code spellcheck="false">y</code> axis; otherwise it will be half inside the floor:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> walls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">'#ac8e82'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
walls<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">1.25</span>
house<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>walls<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-03.png" src="./assets/lessons/17/step-03.png" width="1792" height="1120" alt="./assets/lessons/17/step-03.png" class="is-loaded"></span></p>
<p>We chose <code spellcheck="false">2.5</code> for the height because it would seem like a normal height for the ceiling. We also chose <code spellcheck="false">'#ac8e82'</code> for the color, but it's temporary, and we will replace those colors with textures later.</p>
<p>For the roof, we want to make a pyramid shape. The problem is that Three.js doesn't have this kind of geometry. But if you start from a cone and reduce the number of sides to <code spellcheck="false">4</code>, you'll get a pyramid. Sometimes you just have to deflect basic features usages:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// Roof</span>
<span class="token keyword">const</span> roof <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>ConeGeometry</span><span class="token punctuation">(</span><span class="token number">3.5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">'#b35f45'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
roof<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.25</span>
roof<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">2.5</span> <span class="token operator">+</span> <span class="token number">0.5</span>
house<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>roof<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-04.png" src="./assets/lessons/17/step-04.png" width="1792" height="1120" alt="./assets/lessons/17/step-04.png" class="is-loaded"></span></p>
<p>Finding the right position and the right rotation might be a little hard. Take your time, try to figure out the logic behind the values, and don't forget that <code spellcheck="false">Math.PI</code> is your friend.</p>
<p>As you can see, we left <code spellcheck="false">2.5 + 0.5</code>. We could have written <code spellcheck="false">3</code> but it's sometime better to visualize the logic behind the value. <code spellcheck="false">2.5</code>, because the roof walls are <code spellcheck="false">2.5</code> units high and <code spellcheck="false">0.5</code> because the cone is <code spellcheck="false">1</code> unit high (and we need to move it up to half its height).</p>
<p>We will use a simple plane for the door as we are going to use the beautiful door texture we used in a previous lesson.</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// Door</span>
<span class="token keyword">const</span> door <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">'#aa7b7b'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
door<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token number">1</span>
door<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">0.01</span>
house<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>door<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-05.png" src="./assets/lessons/17/step-05.png" width="1792" height="1120" alt="./assets/lessons/17/step-05.png" class="is-loaded"></span></p>
<p>We don't know yet if the plane has the right size, but we can fix that later when we have the textures working.</p>
<p>As you can see, we move the door on the <code spellcheck="false">z</code> axis to stick it to the wall but we also added <code spellcheck="false">0.01</code> units. If you don't add this small value, you'll have a bug we already saw in a previous lesson called z-fighting. Z-fighting happens when you have two faces in the same position (or very close). The GPU doesn't know which one is closer than the other, and you get some strange visual pixel fighting.</p>
<p>Let's add some bushes. Instead of creating one geometry for each bush, we will create only one, and all meshes will share it. The result will be visually the same, but we'll get a performance improvement. We can do the same with the material.</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// Bushes</span>
<span class="token keyword">const</span> bushGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>SphereGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bushMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">'#89c854'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bush1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>bushGeometry<span class="token punctuation">,</span> bushMaterial<span class="token punctuation">)</span>
bush1<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">,</span> <span class="token number">0.5</span><span class="token punctuation">)</span>
bush1<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bush2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>bushGeometry<span class="token punctuation">,</span> bushMaterial<span class="token punctuation">)</span>
bush2<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">,</span> <span class="token number">0.25</span><span class="token punctuation">)</span>
bush2<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.4</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">2.1</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bush3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>bushGeometry<span class="token punctuation">,</span> bushMaterial<span class="token punctuation">)</span>
bush3<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">,</span> <span class="token number">0.4</span><span class="token punctuation">)</span>
bush3<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> bush4 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>bushGeometry<span class="token punctuation">,</span> bushMaterial<span class="token punctuation">)</span>
bush4<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">,</span> <span class="token number">0.15</span><span class="token punctuation">)</span>
bush4<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0.05</span><span class="token punctuation">,</span> <span class="token number">2.6</span><span class="token punctuation">)</span>

house<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>bush1<span class="token punctuation">,</span> bush2<span class="token punctuation">,</span> bush3<span class="token punctuation">,</span> bush4<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-06.png" src="./assets/lessons/17/step-06.png" width="1792" height="1120" alt="./assets/lessons/17/step-06.png" class="is-loaded"></span></p>
<p>It does take too long to place and scale all these objects directly in the code. In a later lesson, we will learn how to use a 3D software to create all of this.</p>
<p>We won't add too many details to the house because we must move forward, but feel free to pause and add anything you want like low walls, an alley, windows, a chimney, rocks, etc.</p>
<h2>The graves</h2>
<p>Instead of placing each grave manually, we are going to create and place them procedurally.</p>
<p>The idea is to place the graves randomly on a circle around the house.</p>
<p>First, let's create a container just in case:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// Graves</span>
<span class="token keyword">const</span> graves <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Group</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>graves<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Like in the <strong>3D Text</strong> lesson where we created multiple donuts with one geometry and one material, we are going to create one <a target="_blank" href="https://threejs.org/docs/index.html#api/en/geometries/BoxGeometry">BoxGeometry</a> and one <a target="_blank" href="https://threejs.org/docs/index.html#api/en/materials/MeshStandardMaterial">MeshStandardMaterial</a> that will be shared amongst every graves:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> graveGeometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">0.6</span><span class="token punctuation">,</span> <span class="token number">0.8</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> graveMaterial <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> color<span class="token operator">:</span> <span class="token string">'#b2b6b1'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Finally, let's loop and do some mathematics to position a bunch of graves around the house.</p>
<p>We are going to create a random angle on a circle. Remember that a full revolution is 2 times Ï€. Then we are going to use that angle on both a <code spellcheck="false">sin(...)</code> and a <code spellcheck="false">cos(...)</code>. This is how you position things on a circle when you have the angle. And finally we also multiply those <code spellcheck="false">sin(...)</code> and <code spellcheck="false">cos(...)</code> results by a random value because we don't want the graves to be positioned on a perfect circle.</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span> <span class="token comment">// Random angle</span>
<span class="token keyword">const</span> radius <span class="token operator">=</span> <span class="token number">3</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">6</span>      <span class="token comment">// Random radius</span>
<span class="token keyword">const</span> x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius        <span class="token comment">// Get the x position using cosinus</span>
<span class="token keyword">const</span> z <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>angle<span class="token punctuation">)</span> <span class="token operator">*</span> radius        <span class="token comment">// Get the z position using sinus</span>

<span class="token comment">// Create the mesh</span>
<span class="token keyword">const</span> grave <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>graveGeometry<span class="token punctuation">,</span> graveMaterial<span class="token punctuation">)</span>

<span class="token comment">// Position</span>
grave<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">,</span> z<span class="token punctuation">)</span>                              

<span class="token comment">// Rotation</span>
grave<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>z <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.4</span>
grave<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y <span class="token operator">=</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">0.5</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">0.4</span>

<span class="token comment">// Add to the graves container</span>
graves<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>grave<span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-07.png" src="./assets/lessons/17/step-07.png" width="1792" height="1120" alt="./assets/lessons/17/step-07.png" class="is-loaded"></span></p>
<h2>Lights</h2>
<p>We have a pretty cool scene, but it's not that scary yet.</p>
<p>First, let's dim the ambient and moon lights and give those a more blue-ish color:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> ambientLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AmbientLight</span><span class="token punctuation">(</span><span class="token string">'#b9d5ff'</span><span class="token punctuation">,</span> <span class="token number">0.12</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>

<span class="token keyword">const</span> moonLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span><span class="token string">'#b9d5ff'</span><span class="token punctuation">,</span> <span class="token number">0.12</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-08.png" src="./assets/lessons/17/step-08.png" width="1792" height="1120" alt="./assets/lessons/17/step-08.png" class="is-loaded"></span></p>
<p>We can't see much right now. Let's also add a warm <a target="_blank" href="https://threejs.org/docs/index.html#api/en/lights/PointLight">PointLight</a> above the door. Instead of adding this light to the scene, we can add it to the house:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// Door light</span>
<span class="token keyword">const</span> doorLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span><span class="token string">'#ff7d46'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span>
doorLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">,</span> <span class="token number">2.7</span><span class="token punctuation">)</span>
house<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>doorLight<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-09.png" src="./assets/lessons/17/step-09.png" width="1792" height="1120" alt="./assets/lessons/17/step-09.png" class="is-loaded"></span></p>
<h2>Fog</h2>
<p>In horror movies, they always use fog. The good news is that Three.js supports it already with the <a target="_blank" href="https://threejs.org/docs/#api/en/scenes/Fog">Fog</a> class.</p>
<p>The first parameter is the <code spellcheck="false">color</code>, the second parameter is the <code spellcheck="false">near</code> (how far from the camera does the fog start), and the third parameter is the <code spellcheck="false">far</code> (how far from the camera will the fog be fully opaque).</p>
<p>To activate the fog, add the  <code spellcheck="false">fog</code> property to the <code spellcheck="false">scene</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">/**
* Fog
*/</span>
<span class="token keyword">const</span> fog <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Fog</span><span class="token punctuation">(</span><span class="token string">'#262837'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span>fog <span class="token operator">=</span> fog</code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-10.png" src="./assets/lessons/17/step-10.png" width="1792" height="1120" alt="./assets/lessons/17/step-10.png" class="is-loaded"></span></p>
<p>Not bad, but we can see a clean cut between the graves and the black background.</p>
<p>To fix that, we must change the clear color of the <code spellcheck="false">renderer</code> and use the same color as the fog. Do that after instantiating the <code spellcheck="false">renderer</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">renderer<span class="token punctuation">.</span><span class="token function">setClearColor</span><span class="token punctuation">(</span><span class="token string">'#262837'</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-11.png" src="./assets/lessons/17/step-11.png" width="1792" height="1120" alt="./assets/lessons/17/step-11.png" class="is-loaded"></span></p>
<p>Here's a slightly scarier scene.</p>
<h2>Textures</h2>
<p>For even more realism, we can add textures. The <code spellcheck="false">textureLoader</code> is already in the code.</p>
<h3>The door</h3>
<p>Let's start with something we already know and load all the door textures:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> doorColorTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/door/color.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> doorAlphaTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/door/alpha.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> doorAmbientOcclusionTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/door/ambientOcclusion.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> doorHeightTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/door/height.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> doorNormalTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/door/normal.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> doorMetalnessTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/door/metalness.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> doorRoughnessTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/door/roughness.jpg'</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Then we can apply all those textures to the door material. Don't forget to add more subdivisions to the <a target="_blank" href="https://threejs.org/docs/index.html#api/en/geometries/PlaneGeometry">PlaneGeometry</a>, so the <code spellcheck="false">displacementMap</code> has some vertices to move. Also, add the <code spellcheck="false">uv2</code> attribute to the geometry for the <code spellcheck="false">aoMap</code> as we did in the <strong>Materials</strong> lesson.</p>
<p>You can access the door's geometry by using <code spellcheck="false">mesh.geometry</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> door <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
map<span class="token operator">:</span> doorColorTexture<span class="token punctuation">,</span>
transparent<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
alphaMap<span class="token operator">:</span> doorAlphaTexture<span class="token punctuation">,</span>
aoMap<span class="token operator">:</span> doorAmbientOcclusionTexture<span class="token punctuation">,</span>
displacementMap<span class="token operator">:</span> doorHeightTexture<span class="token punctuation">,</span>
displacementScale<span class="token operator">:</span> <span class="token number">0.1</span><span class="token punctuation">,</span>
normalMap<span class="token operator">:</span> doorNormalTexture<span class="token punctuation">,</span>
metalnessMap<span class="token operator">:</span> doorMetalnessTexture<span class="token punctuation">,</span>
roughnessMap<span class="token operator">:</span> doorRoughnessTexture
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
door<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'uv2'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Float32BufferAttribute</span><span class="token punctuation">(</span>door<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>uv<span class="token punctuation">.</span>array<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-12.png" src="./assets/lessons/17/step-12.png" width="1792" height="1120" alt="./assets/lessons/17/step-12.png" class="is-loaded"></span></p>
<p>There you go! That's a more realistic door.</p>
<p>Now that we have the textures, you realize that the door is a little too small. You can simply increase the <a target="_blank" href="https://threejs.org/docs/index.html#api/en/geometries/PlaneGeometry">PlaneGeometry</a> sizes:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">2.2</span><span class="token punctuation">,</span> <span class="token number">2.2</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment">// ...</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-13.png" src="./assets/lessons/17/step-13.png" width="1792" height="1120" alt="./assets/lessons/17/step-13.png" class="is-loaded"></span></p>
<h3>The walls</h3>
<p>Let's do the same for the walls using the textures on the <code spellcheck="false">/static/textures/bricks/</code> folder. We don't have as many textures as for the door, but it's not a problem. We don't need an alpha texture, and the wall has no metal in it, so we don't need a metalness texture either.</p>
<p>Load the textures:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> bricksColorTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/bricks/color.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bricksAmbientOcclusionTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/bricks/ambientOcclusion.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bricksNormalTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/bricks/normal.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> bricksRoughnessTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/bricks/roughness.jpg'</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Then we can update our <a target="_blank" href="https://threejs.org/docs/index.html#api/en/materials/MeshStandardMaterial">MeshStandardMaterial</a> for the wall. Don't forget to remove the <code spellcheck="false">color</code> and add the <code spellcheck="false">uv2</code> attribute for the ambient occlusion.</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> walls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
map<span class="token operator">:</span> bricksColorTexture<span class="token punctuation">,</span>
aoMap<span class="token operator">:</span> bricksAmbientOcclusionTexture<span class="token punctuation">,</span>
normalMap<span class="token operator">:</span> bricksNormalTexture<span class="token punctuation">,</span>
roughnessMap<span class="token operator">:</span> bricksRoughnessTexture
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
walls<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'uv2'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Float32BufferAttribute</span><span class="token punctuation">(</span>walls<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>uv<span class="token punctuation">.</span>array<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-14.png" src="./assets/lessons/17/step-14.png" width="1792" height="1120" alt="./assets/lessons/17/step-14.png" class="is-loaded"></span></p>
<h3>The floor</h3>
<p>Same deal as for the walls. The grass textures are located in the <code spellcheck="false">/static/textures/grass/</code> folder.</p>
<p>Load the textures:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> grassColorTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/grass/color.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> grassAmbientOcclusionTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/grass/ambientOcclusion.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> grassNormalTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/grass/normal.jpg'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> grassRoughnessTexture <span class="token operator">=</span> textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">'/textures/grass/roughness.jpg'</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Update the <a target="_blank" href="https://threejs.org/docs/index.html#api/en/materials/MeshStandardMaterial">MeshStandardMaterial</a> of the floor and don't forget to remove the <code spellcheck="false">color</code> and add the <code spellcheck="false">uv2</code> attribute for the ambient occlusion:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> floor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PlaneGeometry</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
map<span class="token operator">:</span> grassColorTexture<span class="token punctuation">,</span>
aoMap<span class="token operator">:</span> grassAmbientOcclusionTexture<span class="token punctuation">,</span>
normalMap<span class="token operator">:</span> grassNormalTexture<span class="token punctuation">,</span>
roughnessMap<span class="token operator">:</span> grassRoughnessTexture
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
floor<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token string">'uv2'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Float32BufferAttribute</span><span class="token punctuation">(</span>floor<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>uv<span class="token punctuation">.</span>array<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-15.png" src="./assets/lessons/17/step-15.png" width="1792" height="1120" alt="./assets/lessons/17/step-15.png" class="is-loaded"></span></p>
<p>The texture is too large. To fix that, we can simply repeat each grass texture with the <code spellcheck="false">repeat</code> property:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">grassColorTexture<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
grassAmbientOcclusionTexture<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
grassNormalTexture<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
grassRoughnessTexture<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-16.png" src="./assets/lessons/17/step-16.png" width="1792" height="1120" alt="./assets/lessons/17/step-16.png" class="is-loaded"></span></p>
<p>And don't forget to change the <code spellcheck="false">wrapS</code> and <code spellcheck="false">wrapT</code> properties to activate the repeat:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">grassColorTexture<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
grassAmbientOcclusionTexture<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
grassNormalTexture<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
grassRoughnessTexture<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping

grassColorTexture<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
grassAmbientOcclusionTexture<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
grassNormalTexture<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
grassRoughnessTexture<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping</code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-17.png" src="./assets/lessons/17/step-17.png" width="1792" height="1120" alt="./assets/lessons/17/step-17.png" class="is-loaded"></span></p>
<h2>Ghosts</h2>
<p>For the ghosts, let's keep things simple and do with what we know.</p>
<p>We are going to use simple lights floating around the house and passing through the ground and graves.</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">/**
* Ghosts
*/</span>
<span class="token keyword">const</span> ghost1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span><span class="token string">'#ff00ff'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ghost1<span class="token punctuation">)</span>

<span class="token keyword">const</span> ghost2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span><span class="token string">'#00ffff'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ghost2<span class="token punctuation">)</span>

<span class="token keyword">const</span> ghost3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PointLight</span><span class="token punctuation">(</span><span class="token string">'#ffff00'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>ghost3<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Now we can animate them using some mathematics with a lot of trigonometry:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> clock <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Clock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> <span class="token function-variable function">tick</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> elapsedTime <span class="token operator">=</span> clock<span class="token punctuation">.</span><span class="token function">getElapsedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Ghosts</span>
<span class="token keyword">const</span> ghost1Angle <span class="token operator">=</span> elapsedTime <span class="token operator">*</span> <span class="token number">0.5</span>
ghost1<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>ghost1Angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span>
ghost1<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ghost1Angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">4</span>
ghost1<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> ghost2Angle <span class="token operator">=</span> <span class="token operator">-</span> elapsedTime <span class="token operator">*</span> <span class="token number">0.32</span>
ghost2<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>ghost2Angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span>
ghost2<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ghost2Angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">5</span>
ghost2<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">*</span> <span class="token number">2.5</span><span class="token punctuation">)</span>

<span class="token keyword">const</span> ghost3Angle <span class="token operator">=</span> <span class="token operator">-</span> elapsedTime <span class="token operator">*</span> <span class="token number">0.18</span>
ghost3<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">cos</span><span class="token punctuation">(</span>ghost3Angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">*</span> <span class="token number">0.32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ghost3<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>ghost3Angle<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span><span class="token number">7</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">*</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ghost3<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">sin</span><span class="token punctuation">(</span>elapsedTime <span class="token operator">*</span> <span class="token number">2.5</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>
            </p><div class="js-video video is-playing">
                <video class="js-element element" width="1792" height="1120" controls="" src="./assets/lessons/17/step-18.mp4"></video>
                <div class="js-overlay overlay"></div>
                <div class="logo">
                    <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.5 66.6" style="enable-background:new 0 0 58.5 66.6;" xml:space="preserve">
                        <path class="face-1" d="M23.1,55.7l16.1-9.3c0,0,0,0,0,0c1.1-0.7,1.8-1.9,1.8-3.1l0.1-19.1L23.1,34.4V55.7z"></path>
                        <path class="face-2" d="M21.3,10L2.9,20.5l18,10.2l18.4-10.5c0,0,0,0-0.1,0l-17.4-10C21.7,10.1,21.5,10.1,21.3,10z"></path>
                        <path class="face-3" d="M1.8,46.7L18,56.6c0,0,0,0,0,0c0.3,0.2,0.5,0.3,0.8,0.3V34.5L0,23.8v19.7C0,44.9,0.7,46.1,1.8,46.7z"></path>
                        <path class="triangle-1" d="M56.8,30.4l-11.4-6.6l-0.1,19.2l11.5-6.7c1-0.6,1.7-1.7,1.7-2.9C58.5,32.1,57.9,31,56.8,30.4z"></path>
                        <path class="triangle-2" d="M0,50.7v12.6c0,1.2,0.6,2.3,1.7,2.9c0.5,0.3,1.1,0.5,1.7,0.5c0.6,0,1.2-0.2,1.7-0.5l10.4-6L0,50.7z"></path>
                        <path class="triangle-3" d="M16.4,7L5.1,0.5c-1-0.6-2.3-0.6-3.4,0C0.6,1.1,0,2.2,0,3.4v13.2L16.4,7z"></path>
                    </svg>
                </div>
            </div>
        <p></p>
<h2>Shadows</h2>
<p>Finally, to add more realism, let's add shadows.</p>
<p>Activate the shadow map on the renderer:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Activate the shadows on the lights that you think should cast shadows:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">moonLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
doorLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
ghost1<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
ghost2<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
ghost3<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Go through each object of your scene and decide if that object can cast and/or receive shadows:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">walls<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
bush1<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
bush2<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
bush3<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
bush4<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>

<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">50</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>
grave<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

floor<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-19.png" src="./assets/lessons/17/step-19.png" width="1792" height="1120" alt="./assets/lessons/17/step-19.png" class="is-loaded"></span></p>
<p>The scene looks much better with these shadows, but we should optimize them anyway.</p>
<p>A good thing would be to go through each light, create camera helpers on the <code spellcheck="false">light.shadowMap.camera</code>, and make sure the <code spellcheck="false">near</code>, the <code spellcheck="false">far</code>, the <code spellcheck="false">amplitude</code> or the <code spellcheck="false">fov</code> fit nicely. But instead, let's use the following values that should be just right.</p>
<p>We can also reduce the shadow map render sizes to improve performances:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">moonLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span>
moonLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">256</span>
moonLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">15</span>

<span class="token comment">// ...</span>

doorLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span>
doorLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">256</span>
doorLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">7</span>

<span class="token comment">// ...</span>

ghost1<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span>
ghost1<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">256</span>
ghost1<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">7</span>

<span class="token comment">// ...</span>

ghost2<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span>
ghost2<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">256</span>
ghost2<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">7</span>

<span class="token comment">// ...</span>

ghost3<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">256</span>
ghost3<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">256</span>
ghost3<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">7</span>

<span class="token comment">// ...</span>

renderer<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>PCFSoftShadowMap</code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/17/step-20.png" src="./assets/lessons/17/step-20.png" width="1792" height="1120" alt="./assets/lessons/17/step-20.png" class="is-loaded"></span></p>
<p>This process is long, but it's essential. We are already flirting with performance limitations, and the haunted house might not even work at 60fps on mobile. We will see more optimization tips in a future lesson.</p>
<h2>Go further</h2>
<p>That's it for the lesson, but you can try to improve what we did. You can add new elements in the scene, replace the ghosts with real 3D ghosts by using Three.js primitives, add names on the grave, etc.</p>
    </section>
</body>

</html>