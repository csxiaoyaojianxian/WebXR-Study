<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link type="text/css" rel="stylesheet" href="./public.css" />
</head>

<section class="text js-text">
    <h2>Introduction</h2>
<p>To this point, all the exercises have been small enough to fit into a single JavaScript file without struggling too much. We've separated the different parts of our code by using block comments, and we've scrolled a lot.</p>
<p>But real-life projects tend to have much more code. Having everything as tangled as spaghetti in one file soon becomes an issue. For example:</p>
<ul>
<li>It's hard to find what you want.</li>
<li>It's hard to re-use specific parts.</li>
<li>You need to make sure that variables are not in conflict with other variables.</li>
<li>If you work with other developers, you'll have a lot of conflicts on that file.</li>
<li>You'll start to have cramps in your fingers because you have to scroll so much.</li>
<li>Etc.</li>
</ul>
<p>We need a way to structure our code in a more maintainable way.</p>
<p>Though this course is dedicated to Three.js, we are going to learn JavaScript concepts like classes and modules for this lesson. They will become very handy when it comes to organizing our code.</p>
<p>In the following parts of the lesson, I will show you how I (Bruno Simon) like to organize my code. This is based on very personal preferences that you might not agree with, and you might be right. Don't hesitate to create your own structure and only take what you think is good from the following advice.</p>
<p>In the rest of the course, for simplicity's sake and in case some of you are not comfortable with what you will learn here, we won't be using the structure presented in this lesson. We will keep coding all the JavaScript in one file (spaghetti style). But if you feel comfortable trying the new structure in this lesson, you can adapt the following lessons to the new way or to your own structure.</p>
<h2>Concepts</h2>
<h3>Modules</h3>
<p>Modules are one of the most important features used to structure our code. The idea is to separate our code into multiple files and import those files when we need them.</p>
<p>We actually already use modules when we import dependencies like this:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token keyword">import</span> gsap <span class="token keyword">from</span> <span class="token string">'gsap'</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>But this time, we are going to import our own code.</p>
<h4>Compatibility</h4>
<p>When using Webpack, all our imports are merged into one file that will work on most browsers. This way, we don't even have to worry about the compatibility of modules.</p>
<p>Furthermore, modules are now natively supported by most modern browsers without using a bundler. But, we aren't going to use that native support for a couple of reasons:</p>
<ul>
<li>Not all browsers are compatible with it (<a target="_blank" href="https://caniuse.com/?search=import">Can I Use</a>).</li>
<li>We already need Webpack for other reasons like NPM dependencies, shader files integration (later in the course), local server, etc. And modules are natively supported by Webpack.</li>
</ul>
<h4>Syntax</h4>
<p>We are going to ignore the current state of our project for a moment to focus on syntax.</p>
<p>In <code spellcheck="false">/src/script.js</code>, comment out everything (even the CSS import).</p>
<p>In the <code spellcheck="false">/src/</code> folder, create a <code spellcheck="false">test.js</code> file. We are going to add content to that file and import it into <code spellcheck="false">script.js</code>.</p>
<p>A file can export one or multiple things, but, to keep things simple, I like to export only one thing per file.</p>
<p>To do that, write the following code in <code spellcheck="false">test.js</code> :</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token string">'Hello modules'</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And then, to import this code into <code spellcheck="false">/src/script.js</code>, write the following code:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">'./test.js'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And that's it. Check your console and you should see <code spellcheck="false">Hello modules</code>.</p>
<p>One very important detail is that the path starts with <code spellcheck="false">./</code>. When we refer to a file, we need to do it that way, otherwise Webpack will try to find it in the <code spellcheck="false">node_modules</code> folder.</p>
<p>Here, we exported a string, which is not very useful. But we can export functions:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// test.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello modules'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// scripts.js</span>
<span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">'./test.js'</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We can also export objects:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// test.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
hello<span class="token operator">:</span> <span class="token string">'modules'</span>
<span class="token punctuation">}</span>

<span class="token comment">// scripts.js</span>
<span class="token keyword">import</span> test <span class="token keyword">from</span> <span class="token string">'./test.js'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And we can also export classes, but we are going to see that later.</p>
<p>The <code spellcheck="false">export</code> instruction can also be done after the object:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// test.js</span>
<span class="token keyword">const</span> somethingToExport <span class="token operator">=</span> <span class="token punctuation">{</span>
hello<span class="token operator">:</span> <span class="token string">'modules'</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> somethingToExport</code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And as I said earlier, one file can export multiple things:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// test.js</span>
<span class="token keyword">const</span> oneThing <span class="token operator">=</span> <span class="token punctuation">{</span>
hello<span class="token operator">:</span> <span class="token string">'modules'</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">anotherThing</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token punctuation">{</span> oneThing<span class="token punctuation">,</span> anotherThing <span class="token punctuation">}</span>

<span class="token comment">// scripts.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> oneThing<span class="token punctuation">,</span> anotherThing <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./test.js'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oneThing<span class="token punctuation">)</span>
<span class="token function">anotherThing</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>By exporting multiple things, we don't need to import everything in the module. We can select what we want:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// script.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> oneThing <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./test.js'</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>oneThing<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And this is actually how Three.js classes can be imported without importing the whole library. </p>
<p>Currently, when we import Three.js, we do:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And everything that is being exported from <code spellcheck="false">three</code> will be available in the <code spellcheck="false">THREE</code> variable. But we could have imported specific classes like this:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{</span> SphereGeometry <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three'</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>But again, we are not going to use that feature and each one of our files is going to export only one thing.</p>
<h3>Classes</h3>
<p>Now that we know how to separate our code into multiple files, what should we export and import exactly?</p>
<p>We are going to use classes for exporting and importing. Classes allow us to use <strong>Object-Oriented Programming</strong> in JavaScript.</p>
<h4>Compatibility</h4>
<p>Classes are supported by most browsers (<a target="_blank" href="https://caniuse.com/es6-class">Can I Use</a>), so we can use them without trouble.</p>
<h4>Creating a class</h4>
<p>Remove the code related to modules (even the <code spellcheck="false">test.js</code> file) and leave the rest of the code commented. We are going to focus on the classes now.</p>
<p>To create a class, use the following syntax in <code spellcheck="false">/src/script.js</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">HelloClass</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>If you test this code now, nothing will happen because our class is currently empty and we haven't used it anywhere else in our code. But, in the classes in the example below, we are going to put some code between the <code spellcheck="false">{}</code>.</p>
<p>Also, you should note that class names, by convention, usually use the <strong>PascalCase</strong> where the first letter of each word is in uppercase.</p>
<h4>Instantiating the class</h4>
<p>A class is like a blueprint. We can use that blueprint to create an object. We can also use that blueprint to create multiple objects.</p>
<p>Let's imagine that our class is a blueprint to create a robot:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>To create a robot from that blueprint, we would need to write this:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> robot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>robot<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And that's it. Though this class does nothing and thus our <code spellcheck="false">robot</code> variable does nothing, we created a robot out of our <code spellcheck="false">Robot</code> class.</p>
<p>The <code spellcheck="false">robot</code> variable is what we call an <strong>instance</strong> of the class.</p>
<p>As already noted, we can also create multiple instances of that class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">const</span> wallE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ultron <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> astroBoy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>All of those robots will be based on the same class.</p>
<h4>Methods</h4>
<p>That's cute, but our robots can't do anything. We can add functions to our robots like this:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Functions inside of a class are called <strong>methods</strong> and every instance of the class will have these methods.</p>
<p>Now, each one of our robots can say "hi".</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">ultron<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
astroBoy<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>But how impolite it is for those robots to not say "thank you" to their creator for being created!</p>
<p>If you add a method named <code spellcheck="false">constructor</code> to the class, this method will be called automatically when instantiated:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Thank you creator'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Now, every robot being created with this class will say "Thank you creator" automatically when instantiated.</p>
<p>We can also provide parameters to that <code spellcheck="false">constructor</code>.</p>
<p>To illustrate that, we are going to give a name to each one of the robots:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> wallE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Wall-E'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ultron <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Ultron'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> astroBoy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Astro Boy'</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And to retrieve those names in the class, we can add the parameter to the <code spellcheck="false">constructor</code> function:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Thank you creator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<h4>Context</h4>
<p>But what if we also want the robot to provide his name when saying "hi"?</p>
<p>We already sent the name to the constructor and we don't want to send it again to the <code spellcheck="false">sayHi</code> function. What we want is for the robot to remember his name.</p>
<p>We can do that with <code spellcheck="false">this</code>. Write the following code:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Thank you creator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hello!'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p><code spellcheck="false">this</code> is what we call the <code spellcheck="false">context</code>. Though the class is the same for each instance, the context will be different for every instances of the class.</p>
<p>In our case, <code spellcheck="false">this</code> will be the robot itself.</p>
<p><code spellcheck="false">this</code> is accessible in every method which is why we can now retrieve the name of the robot in the <code spellcheck="false">sayHi</code> function:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello! My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p><code spellcheck="false">name</code> is what we call a property of the class. We can add more properties:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> legs</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token keyword">this</span><span class="token punctuation">.</span>legs <span class="token operator">=</span> legs

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Thank you creator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> wallE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Wall-E'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ultron <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Ultron'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> astroBoy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Astro Boy'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We can also access properties from the instance outside of the class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">const</span> wallE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Wall-E'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ultron <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Ultron'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> astroBoy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Astro Boy'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>wallE<span class="token punctuation">.</span>legs<span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Methods are also available from the context and we can ask the robot to say "hi" automatically in the <code spellcheck="false">constructor</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> legs</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token keyword">this</span><span class="token punctuation">.</span>legs <span class="token operator">=</span> legs

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Thank you creator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<h4>Inheritance</h4>
<p>Inheritance is like creating a class based on another class. In a way, we create a blueprint based on another blueprint.</p>
<p>All the methods of the base class will be available in the new class.</p>
<p>To illustrate that, let's add a feature to our robots so that they can fly. But not every robot can fly like Wall-E. Still, every robot needs a name and legs.</p>
<p>To create a class based on another, use the <code spellcheck="false">extends</code> keyword. Create the following class after the <code spellcheck="false">Robot</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">FlyingRobot</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We have created a <code spellcheck="false">FlyingRobot</code> class which we can now use for robots that can fly:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> wallE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Wall-E'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ultron <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlyingRobot</span><span class="token punctuation">(</span><span class="token string">'Ultron'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> astroBoy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlyingRobot</span><span class="token punctuation">(</span><span class="token string">'Astro Boy'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Currently, this <code spellcheck="false">FlyingRobot</code> doesn't add anything to the <code spellcheck="false">Robot</code> class, but we can add methods like this:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">FlyingRobot</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">takeOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Have a good flight </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">land</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Welcome back </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Robots instantiated with <code spellcheck="false">FlyingRobot</code> will still be able to say "hi", but now they will also be able to take off and land:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">astroBoy<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
astroBoy<span class="token punctuation">.</span><span class="token function">takeOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
astroBoy<span class="token punctuation">.</span><span class="token function">land</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>But if we try to do the same with Wall-E:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">wallE<span class="token punctuation">.</span><span class="token function">takeOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We get an error. Wall-E isn't an instance of <code spellcheck="false">FlyingRobot</code> and thus can't take off.</p>
<p>Providing a method with the same name to the <code spellcheck="false">FlyingRobot</code> class will override what the method does in the <code spellcheck="false">Robot</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">FlyingRobot</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello! My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> and I am a flying robot</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>But if you want to provide a different <code spellcheck="false">constructor</code>, you have to start the method with <code spellcheck="false">super()</code> and send the needed parameters to it:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">FlyingRobot</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> legs</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> legs<span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>canFly <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p><code spellcheck="false">super</code> corresponds to the base class (<code spellcheck="false">Robot</code>) and using <code spellcheck="false">super()</code> is like calling the base <code spellcheck="false">constructor</code> so that everything we do in the base constructor will be done in the new class, too.</p>
<p>We can also use <code spellcheck="false">super</code> to call methods from the base class. As an example, we can make the robot say "hi" like it use to and then, in another log, say that it is a flying robot:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">class</span> <span class="token class-name">FlyingRobot</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'I am a flying robot'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>But this approach tends to complicate the code.</p>
<p>That's it for classes.</p>
<h3>Combining the classes and the modules</h3>
<p>The idea here is that we are going to separate our code into files and each one of these files will export a different class.</p>
<p>To illustrate that with the robots, create a <code spellcheck="false">/src/Robot.js</code> file and put the <code spellcheck="false">Robot</code> class in it, but with an <code spellcheck="false">export default</code> at the beginning:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> legs</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name
<span class="token keyword">this</span><span class="token punctuation">.</span>legs <span class="token operator">=</span> legs

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">I am </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">. Thank you creator</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello! My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Now create a <code spellcheck="false">/src/FlyingRobot.js</code> file and put the <code spellcheck="false">FlyingRobot</code> class in it, but with an <code spellcheck="false">export default</code> at the beginning:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">FlyingRobot</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> legs</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">super</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> legs<span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>canFly <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>

<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Hello! My name is </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> and I'm a flying robot</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">takeOff</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Have a good flight </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">land</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Welcome back </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Before importing them, however, we need to fix an issue.</p>
<p><code spellcheck="false">FlyingRobot</code> inherits from <code spellcheck="false">Robot</code>, but <code spellcheck="false">Robot</code> isn't available in the file. We need to first import that class to refer to it.</p>
<p>Add the following import:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Robot <span class="token keyword">from</span> <span class="token string">'./Robot.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">FlyingRobot</span> <span class="token keyword">extends</span> <span class="token class-name">Robot</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In <code spellcheck="false">/src/scripts.js</code>, we can now import and use these classes:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Robot <span class="token keyword">from</span> <span class="token string">'./Robot.js'</span>
<span class="token keyword">import</span> FlyingRobot <span class="token keyword">from</span> <span class="token string">'./FlyingRobot.js'</span>

<span class="token keyword">const</span> wallE <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Robot</span><span class="token punctuation">(</span><span class="token string">'Wall-E'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> ultron <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlyingRobot</span><span class="token punctuation">(</span><span class="token string">'Ultron'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> astroBoy <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FlyingRobot</span><span class="token punctuation">(</span><span class="token string">'Astro Boy'</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And our code to create robots becomes suddenly very simple.</p>
<p>At first, all of this might seem a bit complicated, but your code will become much more maintainable and you'll be able to reuse it in different projects simply by copying the classes you need.</p>
<h2>Structuring our project</h2>
<p>It's time to use this new knowledge in our project.</p>
<p>Remove the code that we have added above and delete the files related to the robots.</p>
<p>If you uncomment the project code, you'll see a simple scene with a fox on a floor.</p>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/01.png" src="./assets/lessons/26/01.png" width="1792" height="1120" alt="01.png" class="is-loaded"></span></p>
<p>We are going to keep the existing code and move it into classes piece by piece.</p>
<p>Comment the whole code again except the style (<code spellcheck="false">import './style.css'</code>).</p>
<h3>Experience class</h3>
<p>A good practice is to put the whole experience inside a main class that will then create everything else. This is particularly useful if your WebGL experience is part of a bigger website with HTML content, other pages, etc.</p>
<p>The code related to your experience will be separate from the rest of your code, but still accessible through the class and all the methods and properties you provide within that class.</p>
<p>As for the name of that class, I like to use <code spellcheck="false">Experience</code> but it can be <code spellcheck="false">MySuperGame</code>, <code spellcheck="false">WebGLAwesomeStuff</code>, <code spellcheck="false">Application</code> or whatever.</p>
<h4>Create and instantiate the class</h4>
<p>In the <code spellcheck="false">/src/</code> folder, create an <code spellcheck="false">Experience/</code> folder and, in that <code spellcheck="false">/src/Experience</code> folder, create an <code spellcheck="false">Experience.js</code> file.</p>
<p>In that file, export a class as follows:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Here starts a great experience'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>All classes related to the experience will be in that folder.</p>
<p>In <code spellcheck="false">/src/script.js</code>, we can import and instantiate that class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'./Experience/Experience.js'</span>

<span class="token keyword">const</span> experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/02.png" src="./assets/lessons/26/02.png" width="667" height="68" alt="02.png" class="is-loaded"></span></p>
<p>Sometimes, it's useful to be able to access the experience right from the console. But the current scope makes that impossible.</p>
<p>What we can do is save the instance in <code spellcheck="false">window</code>. To do that, we can use the context right inside the <code spellcheck="false">constructor</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Global access</span>
window<span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Now we can access the experience right from the console by typing <code spellcheck="false">window.experience</code> or even <code spellcheck="false">experience</code> because <code spellcheck="false">window</code> is implicit in JavaScript (what a weirdo).</p>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/03.png" src="./assets/lessons/26/03.png" width="666" height="176" alt="03.png" class="is-loaded"></span></p>
<p>Be careful, this is a trick that not everybody will like and if you have multiple experiences, the last one will override the previous ones.</p>
<h4>Canvas</h4>
<p>When instantiating the Experience, we are going to send the canvas as a parameter so that other developers using our class in different situations will be able to choose what <code spellcheck="false">&lt;canvas&gt;</code> they want to use.</p>
<p>When instantiating in <code spellcheck="false">/src/script.js</code>, use <code spellcheck="false">querySelector()</code> to send the canvas parameter:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">const</span> experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'canvas.webgl'</span><span class="token punctuation">)</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And, in the class, save it as a property:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Options</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> canvas
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>That's the only parameter we will need in this lesson, but you can send any parameter you want to change the experience.</p>
<h3>Useful classes</h3>
<p>There are other classes that are handy to have throughout the project, and that will probably turn out to be useful in your future projects. These classes are not necessarily related to WebGL or Three.js, as you will see. That is the reason why we are going to put them in the <code spellcheck="false">/src/Experience/Utils/</code> folder which we will create now.</p>
<h4>Sizes</h4>
<p>The first useful class is the one that will handle the sizes of the experience. It'll include the width and the height of the viewport as well as the pixel ratio of the screen.</p>
<p>We are going to update these values when a resize occurs, but we are also going to warn the experience of that resize.</p>
<p>In the <code spellcheck="false">/src/Experience/Utils/</code> folder, create the <code spellcheck="false">Sizes.js</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Sizes</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And instantiate it in the <code spellcheck="false">Experience</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Sizes <span class="token keyword">from</span> <span class="token string">'./Utils/Sizes.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In that <code spellcheck="false">Sizes</code> class, add the usual <code spellcheck="false">width</code>, <code spellcheck="false">height</code> and <code spellcheck="false">pixelRatio</code> as we did before, but save them as properties:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Sizes</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
<span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
<span class="token keyword">this</span><span class="token punctuation">.</span>pixelRatio <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Then listen to the resize event and update those properties:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Sizes</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Resize event</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>width <span class="token operator">=</span> window<span class="token punctuation">.</span>innerWidth
<span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> window<span class="token punctuation">.</span>innerHeight
<span class="token keyword">this</span><span class="token punctuation">.</span>pixelRatio <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>devicePixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Here, we assume that the experience always fills the viewport. If that's not the case, you'll have to do things differently.</p>
<p>We can now access the <code spellcheck="false">width</code>, <code spellcheck="false">height</code> and <code spellcheck="false">pixelRatio</code> from the <code spellcheck="false">Experience</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Sizes <span class="token keyword">from</span> <span class="token string">'./Utils/Sizes.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>At some point, we will also have to update other values like the camera or the renderer when a resize occurs. We could listen to the <code spellcheck="false">resize</code> event on <code spellcheck="false">window</code> like we just did, but instead, we are going to use the <code spellcheck="false">Sizes</code> class to warn the other classes about that change.</p>
<h4>Event Emitter</h4>
<p>What we are going to do now is make a little change to our <code spellcheck="false">Sizes</code> class so that it can trigger events. Later, we are going to listen to those events.</p>
<p>To do that, we are going to make that class inherit from an <code spellcheck="false">EventEmitter</code> class.</p>
<p>Add the <code spellcheck="false">EventEmitter</code> class from below to the <code spellcheck="false">/src/Experience/Utils/</code> folder:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>callbacks <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">.</span>base <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">on</span><span class="token punctuation">(</span><span class="token parameter">_names<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Errors</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> _names <span class="token operator">===</span> <span class="token string">'undefined'</span> <span class="token operator">||</span> _names <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'wrong names'</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> callback <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'wrong callback'</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token comment">// Resolve names</span>
<span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveNames</span><span class="token punctuation">(</span>_names<span class="token punctuation">)</span>

<span class="token comment">// Each name</span>
names<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token comment">// Resolve name</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveName</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span>

<span class="token comment">// Create namespace if not exist</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// Create callback if not exist</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token comment">// Add callback</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>callback<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>

<span class="token function">off</span><span class="token punctuation">(</span><span class="token parameter">_names</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Errors</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> _names <span class="token operator">===</span> <span class="token string">'undefined'</span> <span class="token operator">||</span> _names <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'wrong name'</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token comment">// Resolve names</span>
<span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveNames</span><span class="token punctuation">(</span>_names<span class="token punctuation">)</span>

<span class="token comment">// Each name</span>
names<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">_name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token comment">// Resolve name</span>
<span class="token keyword">const</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveName</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span>

<span class="token comment">// Remove namespace</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>namespace <span class="token operator">!==</span> <span class="token string">'base'</span> <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// Remove specific callback in namespace</span>
<span class="token keyword">else</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Default</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>namespace <span class="token operator">===</span> <span class="token string">'base'</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// Try to remove from each namespace</span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> namespace <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span>

                <span class="token comment">// Remove namespace if empty</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
                    <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Specified namespace</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span>

        <span class="token comment">// Remove namespace if empty</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">delete</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>

<span class="token function">trigger</span><span class="token punctuation">(</span><span class="token parameter">_name<span class="token punctuation">,</span> _args</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Errors</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> _name <span class="token operator">===</span> <span class="token string">'undefined'</span> <span class="token operator">||</span> _name <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'wrong name'</span><span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> finalResult <span class="token operator">=</span> <span class="token keyword">null</span>
<span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token comment">// Default args</span>
<span class="token keyword">const</span> args <span class="token operator">=</span> <span class="token operator">!</span><span class="token punctuation">(</span>_args <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">:</span> _args

<span class="token comment">// Resolve names (should on have one event)</span>
<span class="token keyword">let</span> name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveNames</span><span class="token punctuation">(</span>_name<span class="token punctuation">)</span>

<span class="token comment">// Resolve name</span>
name <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resolveName</span><span class="token punctuation">(</span>name<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment">// Default namespace</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>namespace <span class="token operator">===</span> <span class="token string">'base'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Try to find callback in each namespace</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> namespace <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Array</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            result <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>

            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> finalResult <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                finalResult <span class="token operator">=</span> result
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Specified namespace</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span> <span class="token keyword">instanceof</span> <span class="token class-name">Object</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>name<span class="token punctuation">.</span>value <span class="token operator">===</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">'wrong name'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span>
<span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>callbacks<span class="token punctuation">[</span> name<span class="token punctuation">.</span>namespace <span class="token punctuation">]</span><span class="token punctuation">[</span> name<span class="token punctuation">.</span>value <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">callback</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    result <span class="token operator">=</span> <span class="token function">callback</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span>

    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> finalResult <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span>
        finalResult <span class="token operator">=</span> result
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> finalResult
<span class="token punctuation">}</span>

<span class="token function">resolveNames</span><span class="token punctuation">(</span><span class="token parameter">_names</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">let</span> names <span class="token operator">=</span> _names
names <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[^a-zA-Z0-9 ,/.]/g</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
names <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/[,/]+/g</span><span class="token punctuation">,</span> <span class="token string">' '</span><span class="token punctuation">)</span>
names <span class="token operator">=</span> names<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> names
<span class="token punctuation">}</span>

<span class="token function">resolveName</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> newName <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> parts <span class="token operator">=</span> name<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span>

newName<span class="token punctuation">.</span>original  <span class="token operator">=</span> name
newName<span class="token punctuation">.</span>value     <span class="token operator">=</span> parts<span class="token punctuation">[</span> <span class="token number">0</span> <span class="token punctuation">]</span>
newName<span class="token punctuation">.</span>namespace <span class="token operator">=</span> <span class="token string">'base'</span> <span class="token comment">// Base namespace</span>

<span class="token comment">// Specified namespace</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>parts<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> parts<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span> <span class="token operator">!==</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
newName<span class="token punctuation">.</span>namespace <span class="token operator">=</span> parts<span class="token punctuation">[</span> <span class="token number">1</span> <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">return</span> newName
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In case you are wondering, I wrote this class years ago and I've been using it on dozens of projects. We are not going to explain the code, but we are going to explain the methods we need and will use.</p>
<p>Make the <code spellcheck="false">Sizes</code> class inherit from that <code spellcheck="false">EventEmitter</code> class. Don't forget to import it and to use the <code spellcheck="false">super()</code> function at the start of the <code spellcheck="false">constructor</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'./EventEmitter.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Sizes</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Nothing seems to have changed, but now, our <code spellcheck="false">Sizes</code> class has access to the <code spellcheck="false">EventEmitter</code> methods.</p>
<p>There are two methods that we need.</p>
<p>The <code spellcheck="false">on(...)</code> method will listen to events just like <code spellcheck="false">addEventListener()</code> and the <code spellcheck="false">trigger(...)</code> method will trigger those events. We are going to trigger events from inside the class and listen to those events from outside the class.</p>
<p>In the <code spellcheck="false">resize</code> event callback of the <code spellcheck="false">Sizes</code> class, trigger an event named <code spellcheck="false">resize</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Sizes</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>You can choose any name for the event, but <code spellcheck="false">resize</code> seems appropriate.</p>
<p>In the <code spellcheck="false">Experience</code> class, listen to the <code spellcheck="false">resize</code> event on the instance of the <code spellcheck="false">Size</code> class with the same event name:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Sizes <span class="token keyword">from</span> <span class="token string">'./Utils/Sizes.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Global access</span>
window<span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">this</span>

<span class="token comment">// Options</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> canvas

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Resize event</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'A resize occurred'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Resize the viewport and you should see <code spellcheck="false">A resize occurred</code> in the console.</p>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/04.png" src="./assets/lessons/26/04.png" width="373" height="32" alt="04.png" class="is-loaded"></span></p>
<p>Later, we will have more instructions on what to do when a resize occurs, which is why we should put it in a separate method. Create a <code spellcheck="false">resize()</code> method and call that method when the <code spellcheck="false">resize</code> event occurs:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Sizes <span class="token keyword">from</span> <span class="token string">'./Utils/Sizes.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We can't send the <code spellcheck="false">resize</code> method directly as the parameter (<code spellcheck="false">this.sizes.on('resize', this.resize)</code>) because the context (<code spellcheck="false">this</code>) will be the <code spellcheck="false">Sizes</code> instance and not the <code spellcheck="false">Experience</code> instance. This is a classic context issue that we can fix with binding, but we are not going to cover that here. Instead, we will just call <code spellcheck="false">resize</code> from inside an arrow function.</p>
<p>That's it for our <code spellcheck="false">Sizes</code> class.</p>
<h4>Time</h4>
<p>Another very useful class is the one handling the time. This class will work a bit like the <a target="_blank" href="https://threejs.org/docs/#api/en/core/Clock">Clock</a> class of Three.js.</p>
<p>It will save:</p>
<ul>
<li>the current time.</li>
<li>the elapsed time.</li>
<li>the delta time between the current frame and the previous frame.</li>
</ul>
<p>The class will also trigger an event on each frame so that we can listen to that event and update the whole experience.</p>
<p>In the <code spellcheck="false">/src/Experience/Utils/</code> folder, create the <code spellcheck="false">Time.js</code> class and inherit from the <code spellcheck="false">EventEmitter</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'./EventEmitter.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Time</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Instantiate that class in the <code spellcheck="false">Experience</code> class as we did for the <code spellcheck="false">Sizes</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Sizes <span class="token keyword">from</span> <span class="token string">'./Utils/Sizes.js'</span>
<span class="token keyword">import</span> Time <span class="token keyword">from</span> <span class="token string">'./Utils/Time.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Create the following properties in the <code spellcheck="false">Time.js</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'./EventEmitter.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Time</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>start <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start
<span class="token keyword">this</span><span class="token punctuation">.</span>elapsed <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>delta <span class="token operator">=</span> <span class="token number">16</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<ul>
<li><code spellcheck="false">start</code> will contain the timestamp when the experience starts and will stay the same.</li>
<li><code spellcheck="false">current</code> will contain the current timestamp and will change on each frame.</li>
<li><code spellcheck="false">elapsed</code> will contain how much time was spent since the start of the experience.</li>
<li><code spellcheck="false">delta</code> will contain how much time was spent since the previous frame. We set it as 16 by default which is close to how many milliseconds there is between two frames at 60fps.</li>
</ul>
<p>Then we can create a <code spellcheck="false">tick()</code> method and do the same loop as we did at the beginning of the course with <code spellcheck="false">window.requestAnimationFrame(...)</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Time</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'tick'</span><span class="token punctuation">)</span>

window<span class="token punctuation">.</span><span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>You should see a bunch of <code spellcheck="false">tick</code> logs in the console.</p>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/05.png" src="./assets/lessons/26/05.png" width="719" height="109" alt="05.png" class="is-loaded"></span></p>
<p>We could have called the <code spellcheck="false">tick</code> method immediately in the <code spellcheck="false">constructor</code> without the <code spellcheck="false">window.requestAnimationFrame</code>, but this would result in a delta equal to <code spellcheck="false">0</code> on the first frame.</p>
<p>We can now update the <code spellcheck="false">current</code> time, calculate the <code spellcheck="false">delta</code> time and update the <code spellcheck="false">elapsed</code> time:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Time</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> currentTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>delta <span class="token operator">=</span> currentTime <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current
<span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> currentTime
<span class="token keyword">this</span><span class="token punctuation">.</span>elapsed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>You can test those values to make sure that they are right. They will be in milliseconds, but you can do some math to change them to seconds if you prefer.</p>
<p>Finally, we can trigger a <code spellcheck="false">tick</code> event:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Time</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">tick</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> currentTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>delta <span class="token operator">=</span> currentTime <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current
<span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">=</span> currentTime
<span class="token keyword">this</span><span class="token punctuation">.</span>elapsed <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>current <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>start

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'tick'</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And listen to that event in the <code spellcheck="false">Experience</code> class to call an <code spellcheck="false">update()</code> method:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Time tick event</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'tick'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We now have a <code spellcheck="false">resize()</code> method and an <code spellcheck="false">update()</code> method in the <code spellcheck="false">Experience</code>. Those methods are called automatically and they are going to update the rest of the experience when needed.</p>
<p>The <code spellcheck="false">EventEmitter</code> can be used for any of your classes that need to trigger events. For example, it can be used to signal that an animation of the model has finished, that an object has been clicked on, that the player is going out of the level, etc.</p>
<p>Later, we are going to use it to tell the experience that all the resources are loaded.</p>
<h3>Scene</h3>
<p>Now that we have our main class and some useful classes, we can start working with Three.js.</p>
<p>In the <code spellcheck="false">Experience</code> class, add a scene property with the <a target="_blank" href="https://threejs.org/docs/?q=scene#api/en/scenes/Scene">Scene</a> class. Don't forget to import <code spellcheck="false">three</code> like we use to:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<h3>Camera</h3>
<p>For the camera, we are going to create a separate class.</p>
<p>In the <code spellcheck="false">/src/Experience/</code> folder, create a <code spellcheck="false">Camera</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And instantiate it in the <code spellcheck="false">Experience</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>
<span class="token keyword">import</span> Camera <span class="token keyword">from</span> <span class="token string">'./Camera.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Camera</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>But now, we have an issue. In the <code spellcheck="false">Camera</code> class, we are going to instantiate the <a target="_blank" href="https://threejs.org/docs/?q=persp#api/en/cameras/PerspectiveCamera">PerspectiveCamera</a> and the <a target="_blank" href="https://threejs.org/docs/?q=orbit#examples/en/controls/OrbitControls">OrbitControls</a> classes. But these additional classes need information like the <code spellcheck="false">width</code> and <code spellcheck="false">height</code>, as well as the <code spellcheck="false">&lt;canvas&gt;</code> for <a target="_blank" href="https://threejs.org/docs/?q=orbit#examples/en/controls/OrbitControls">OrbitControls</a>. We also need to add this class to the <a target="_blank" href="https://threejs.org/docs/?q=scene#api/en/scenes/Scene">Scene</a>.</p>
<p>In other words, we need access to properties that we have in the <code spellcheck="false">Experience</code> class.</p>
<p>There are three ways of accessing the experience from the camera:</p>
<ul>
<li>From a global variable</li>
<li>By sending a parameter</li>
<li>By using a singleton</li>
</ul>
<p>We are going to explore all three techniques for the sake of learning them, but only use one.</p>
<h4>Accessing the experience</h4>
<p><strong>From a global variable</strong> </p>
<p>Earlier, we added the experience to <code spellcheck="false">window</code> with:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">window<span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">this</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>This makes it accessible anywhere in the code as shown here in the <code spellcheck="false">Camera</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> window<span class="token punctuation">.</span>experience

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>While this works, it assumes that we do have the <code spellcheck="false">experience</code> property available in <code spellcheck="false">window</code> and that there is no other part of the code that will mess up this property.</p>
<p>Adding global properties to <code spellcheck="false">window</code> isn't recommended which is why we won't use that technique.</p>
<p><strong>From a parameter</strong></p>
<p>Another solution would be to send the experience as a parameter to each class that needs it.</p>
<p>In the <code spellcheck="false">Experience</code> class, we would type:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Camera</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And in the <code spellcheck="false">Camera</code> class, we would type this:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">experience</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> experience

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>This solution is a good solution. The main issue is that we need to do this for every class that needs access to the experience as well as to their parents if we have a deeper structure.</p>
<p>We could totally go for this solution, but for the sake of learning, we will use the next one.</p>
<p><strong>Through a singleton</strong></p>
<p>To put it in a nutshell, a singleton is a class that will instantiate just like usual when it's the first time. But, for all the following times, it will return that first instance.</p>
<p>We can do a bunch of <code spellcheck="false">new Experience()</code> instantiations, but only the first one will be the real instance. All the other instantiations will also return that first instance.</p>
<p>To convert our <code spellcheck="false">Experience</code> class to a singleton, add the following code at the very start of the <code spellcheck="false">constructor</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">let</span> instance <span class="token operator">=</span> <span class="token keyword">null</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Singleton</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">return</span> instance
<span class="token punctuation">}</span>
instance <span class="token operator">=</span> <span class="token keyword">this</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We create an <code spellcheck="false">instance</code> variable and set it to <code spellcheck="false">null</code> outside of the class.</p>
<p>In the <code spellcheck="false">constructor</code>, we test if there is something in that variable. If that's the case, then we return what's inside. When we do a <code spellcheck="false">return</code>, the function stops there and the rest won't be executed. Otherwise, we save the instance (<code spellcheck="false">this</code>) in that variable and go on with the rest of the function.</p>
<p>Now, we can import the <code spellcheck="false">Experience</code> wherever we need it  in our code and then instantiate it to retrieve the first instance.</p>
<p>In the <code spellcheck="false">Camera</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'./Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>This solution sounds a bit more clean, but also a bit more complicated. Don't hesitate to use one of the previous solutions if you don't feel comfortable with singletons.</p>
<p>Now that we have access to the experience, we also have access to its properties. We are going to need the <code spellcheck="false">sizes</code>, the <code spellcheck="false">scene</code> and the <code spellcheck="false">canvas</code>. We can save those as properties to the <code spellcheck="false">Camera</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'./Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>sizes
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
<span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>canvas
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<h4>Instance</h4>
<p>Create the <a target="_blank" href="https://threejs.org/docs/?q=orbit#api/en/cameras/PerspectiveCamera">PerspectiveCamera</a> and save it as an <code spellcheck="false">instance</code> property. Don't forget to import <code spellcheck="false">three</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'./Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>sizes
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
<span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>canvas

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>PerspectiveCamera</span><span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height<span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<h4>OrbitControls</h4>
<p>Do the same for the <a target="_blank" href="https://threejs.org/docs/?q=orbit#examples/en/controls/OrbitControls">OrbitControls</a>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> OrbitControls <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/controls/OrbitControls.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setControls</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token function">setControls</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>controls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">OrbitControls</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span>enableDamping <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<h4>Resize</h4>
<p>We can't test it yet, but if we were to resize the viewport, the camera would not be updated.</p>
<p>We could listen to the <code spellcheck="false">resize</code> event on the <code spellcheck="false">Sizes</code> class. But it's better to call it from the parent (<code spellcheck="false">Experience</code>) to the children (<code spellcheck="false">Camera</code>). It's not relevant here, but once we have a lot of classes with many resizes that propagate through the instances, it's useful to have control over the order of those resizes.</p>
<p>In the <code spellcheck="false">Camera</code> class, add the <code spellcheck="false">resize()</code> method:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>aspect <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">updateProjectionMatrix</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In the <code spellcheck="false">resize()</code> method of the <code spellcheck="false">Experience</code> class, call that method:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We still can't really test this because there is nothing in the scene yet that we can see. But you can try to resize the viewport to check for potential errors even if the page stays white.</p>
<h4>Update</h4>
<p>Just as we did with the resize, we also need to update this class on each frame. This is due to the <a target="_blank" href="https://threejs.org/docs/?q=orbit#examples/en/controls/OrbitControls">OrbitControls</a> and its damping feature.</p>
<p>In the <code spellcheck="false">Camera</code> class, create the <code spellcheck="false">update</code> method:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Camera</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>controls<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And call it in the <code spellcheck="false">Experience</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And you should now see a pattern for our structure in which everything starts from the main class and propagates to the children.</p>
<h3>Renderer</h3>
<p>Just like the way we created the <code spellcheck="false">Camera</code> class, let's create a <code spellcheck="false">Renderer</code> class.</p>
<p>Create a <code spellcheck="false">/src/Experience/Renderer.js</code> file.</p>
<p>In this class, retrieve the <code spellcheck="false">Experience</code> and the following properties:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'./Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Renderer</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>canvas <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>canvas
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>sizes
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
<span class="token keyword">this</span><span class="token punctuation">.</span>camera <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>camera
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Import and instantiate this class in the <code spellcheck="false">Experience</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">import</span> Renderer <span class="token keyword">from</span> <span class="token string">'./Renderer.js'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>renderer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Renderer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We can now instantiate the <a target="_blank" href="https://threejs.org/docs/?q=webglrend#api/en/renderers/WebGLRenderer">WebGLRenderer</a> by using the <code spellcheck="false">sizes</code> and <code spellcheck="false">canvas</code> properties. Don't forget to import <code spellcheck="false">three</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'./Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Renderer</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>WebGLRenderer</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
canvas<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>canvas<span class="token punctuation">,</span>
antialias<span class="token operator">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>physicallyCorrectLights <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>outputEncoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>toneMapping <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>CineonToneMapping
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>toneMappingExposure <span class="token operator">=</span> <span class="token number">1.75</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span>shadowMap<span class="token punctuation">.</span>type <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>PCFSoftShadowMap
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Add the <code spellcheck="false">resize()</code> method:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Renderer</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setSize</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>height<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">setPixelRatio</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span>pixelRatio<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And call it from the <code spellcheck="false">resize()</code> method in the <code spellcheck="false">Experience</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">resize</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Add the <code spellcheck="false">update()</code> method to do the render by using the <code spellcheck="false">scene</code> and the <code spellcheck="false">camera</code>. Be careful, the <code spellcheck="false">camera</code> property is an instance of our <code spellcheck="false">Camera</code> class, not the Three.js camera. We can access the Three.js camera by doing <code spellcheck="false">this.camera.instance</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Renderer</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>instance<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And call it in the <code spellcheck="false">Experience</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Still nothing on the screen, but we are getting close. We are actually doing the renders, but our scene is empty.</p>
<h3>World</h3>
<p>It's time to add some visible stuff to our scene. To prevent having too many classes in the <code spellcheck="false">/src/Experience</code> folder, we are going to separate everything that composes our World in a separate class and folder named <code spellcheck="false">World</code>.</p>
<p>Create a <code spellcheck="false">World</code> folder in <code spellcheck="false">/src/Experience/</code> and create a <code spellcheck="false">World</code> class inside it. Start by retrieving the <code spellcheck="false">Experience</code> and the <code spellcheck="false">scene</code> in the newly created class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'../Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Instantiate it in the <code spellcheck="false">Experience</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> World <span class="token keyword">from</span> <span class="token string">'./World/World.js'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>world <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">World</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Let's add a test <a target="_blank" href="https://threejs.org/docs/?q=mesh#api/en/objects/Mesh">Mesh</a> to our <code spellcheck="false">World</code>. Don't forget to import <code spellcheck="false">three</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Test mesh</span>
<span class="token keyword">const</span> testMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshBasicMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span> wireframe<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>testMesh<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/06.png" src="./assets/lessons/26/06.png" width="3072" height="1920" alt="06.png" class="is-loaded"></span></p>
<p>Congratulations, you can finally see something.</p>
<h3>Sunlight</h3>
<p>If you remember what our scene looked like, we had a fox on a floor with lights and shadows. Before going any further, we need to add a light to the scene we are building.</p>
<p>This is a part where the structure can vary a lot according to your project's characteristics and your preferences. For this experience, we are going to create an <code spellcheck="false">Environment</code> class that will contain the light. Later on, we are going to add an environment map to it.</p>
<p>First, let's change our <code spellcheck="false">testMesh</code> material to a <a target="_blank" href="https://threejs.org/docs/?q=meshstan#api/en/materials/MeshStandardMaterial">MeshStandardMaterial</a> so that we will be able to see the light:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Test mesh</span>
<span class="token keyword">const</span> testMesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>BoxGeometry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>testMesh<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/07.png" src="./assets/lessons/26/07.png" width="1792" height="1120" alt="07.png" class="is-loaded"></span></p>
<p>Now create the <code spellcheck="false">Environment</code> class in the <code spellcheck="false">/src/Experience/World/</code> folder:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'../Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And then, instantiate it in the <code spellcheck="false">World</code> class after the <code spellcheck="false">testMesh</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>
<span class="token keyword">import</span> Environment <span class="token keyword">from</span> <span class="token string">'./Environment.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Now, we can add the light to that environment.</p>
<p>Because our light will imitate the sun, we can name the property <code spellcheck="false">sunLight</code>. Don't forget to import <code spellcheck="false">three</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'../Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSunLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setSunLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sunLight <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>DirectionalLight</span><span class="token punctuation">(</span><span class="token string">'#ffffff'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>camera<span class="token punctuation">.</span>far <span class="token operator">=</span> <span class="token number">15</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>mapSize<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>shadow<span class="token punctuation">.</span>normalBias <span class="token operator">=</span> <span class="token number">0.05</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>position<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span> <span class="token number">2.25</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/08.png" src="./assets/lessons/26/08.png" width="1792" height="1120" alt="08.png" class="is-loaded"></span></p>
<p>In the base project, we also had an environment map. We could instantiate a <a target="_blank" href="https://threejs.org/docs/?q=cubete#api/en/loaders/CubeTextureLoader">CubeTextureLoader</a> in the <code spellcheck="false">Environment</code> class, but that would mean that each class would handle resource loading on its own. We would end up with a mess in which we wouldn't know if assets were ready and they would pop on screen when they were loaded.</p>
<h3>Resources</h3>
<p>To make things cleaner, we are going to centralize asset loading in a dedicated class. This class will instantiate all of the loaders we need. We then send an array of assets to load and once all those assets are loaded, we make that class trigger an event.</p>
<p>In the <code spellcheck="false">/src/Experience/Utils/</code> folder, create a <code spellcheck="false">Resources</code> class. We already know that this class is going to trigger an event which is why we can extend the <code spellcheck="false">EventEmitter</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'./EventEmitter.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Resources</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Instantiate it in the <code spellcheck="false">Experience</code> class right after instantiating the scene:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">import</span> Resources <span class="token keyword">from</span> <span class="token string">'./Utils/Resources.js'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Scene</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Resources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>For the list of assets to load, we are going to use an array. Each resource in the array will be defined by an object composed of the following properties:</p>
<ul>
<li><code spellcheck="false">name</code>: which will be used to retrieve the loaded resources.</li>
<li><code spellcheck="false">type</code>: in order to know what loader to use.</li>
<li><code spellcheck="false">path</code>: the path(s) of the file(s) to load.</li>
</ul>
<p>For a bigger project, this array might get a bit fat, which is why it's preferable to have it in a separate file.</p>
<p>In the <code spellcheck="false">/src/Experience/</code> folder, create a <code spellcheck="false">sources.js</code> file that exports the following array:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
<span class="token punctuation">{</span>
name<span class="token operator">:</span> <span class="token string">'environmentMapTexture'</span><span class="token punctuation">,</span>
type<span class="token operator">:</span> <span class="token string">'cubeTexture'</span><span class="token punctuation">,</span>
path<span class="token operator">:</span>
<span class="token punctuation">[</span>
<span class="token string">'textures/environmentMap/px.jpg'</span><span class="token punctuation">,</span>
<span class="token string">'textures/environmentMap/nx.jpg'</span><span class="token punctuation">,</span>
<span class="token string">'textures/environmentMap/py.jpg'</span><span class="token punctuation">,</span>
<span class="token string">'textures/environmentMap/ny.jpg'</span><span class="token punctuation">,</span>
<span class="token string">'textures/environmentMap/pz.jpg'</span><span class="token punctuation">,</span>
<span class="token string">'textures/environmentMap/nz.jpg'</span>
<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We are going to add more sources to this array later.</p>
<p>Now, in the <code spellcheck="false">Experience</code> class, import that array and send it as a parameter to the <code spellcheck="false">Resources</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">import</span> sources <span class="token keyword">from</span> <span class="token string">'./sources.js'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Resources</span><span class="token punctuation">(</span>sources<span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And then save it as a property in the <code spellcheck="false">Resources</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'./EventEmitter.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Resources</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">sources</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// Options</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sources <span class="token operator">=</span> sources

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sources<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>You should see your sources in the console.</p>
<p>In the <code spellcheck="false">Resources</code> class, create these three properties:</p>
<ul>
<li><code spellcheck="false">items</code> which contains the loaded resource; we will populate this property as the sources are being loaded.</li>
<li><code spellcheck="false">toLoad</code> which contains the number of sources to load (<code spellcheck="false">this.sources.length</code>).</li>
<li><code spellcheck="false">loaded</code> which contains the number of sources loaded (starts at <code spellcheck="false">0</code>).</li>
</ul>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> EventEmitter <span class="token keyword">from</span> <span class="token string">'./EventEmitter.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Resources</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">sources</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>toLoad <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sources<span class="token punctuation">.</span>length
<span class="token keyword">this</span><span class="token punctuation">.</span>loaded <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We are now going to create the different loaders. In this project, we will need the <a target="_blank" href="https://threejs.org/docs/?q=GLTFLoader#examples/en/loaders/GLTFLoader">GLTFLoader</a>, the <a target="_blank" href="https://threejs.org/docs/?q=TextureLoader#api/en/loaders/TextureLoader">TextureLoader</a> and the <a target="_blank" href="https://threejs.org/docs/?q=TextureLoader#api/en/loaders/CubeTextureLoader">CubeTextureLoader</a>. We are going to create them all at once, but you would normally have progressively added them as you worked. Don't forget to import <code spellcheck="false">three</code> and the <code spellcheck="false">GLTFLoader</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> GLTFLoader <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'three/examples/jsm/loaders/GLTFLoader.js'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Resources</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">sources</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setLoaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>loaders <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>gltfLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">GLTFLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>textureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>TextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>cubeTextureLoader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CubeTextureLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We are not going to use a Draco compressed model, but if you want to load one, you'll need to add the <a target="_blank" href="https://threejs.org/docs/#examples/en/loaders/DRACOLoader">DracoLoader</a> here as well.</p>
<p>We are now going to create a <code spellcheck="false">startLoading()</code> method. In that method, we are going to loop through the <code spellcheck="false">sources</code> array and load them by using the corresponding loader:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Resources</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">sources</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">startLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token function">startLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Load each source</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> source <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sources<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'gltfModel'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>gltfLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
        source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'texture'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
        source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'cubeTexture'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>cubeTextureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
        source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>You should see the source and the loaded resource being logged in the console as it is loaded.</p>
<p>On each load, we are going to call a <code spellcheck="false">sourceLoaded</code> method that will save the loaded resources in the <code spellcheck="false">items</code> property, update the <code spellcheck="false">loaded</code> property and test if the loading is done. If all the sources are loaded, we trigger a <code spellcheck="false">ready</code> event:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Resources</span> <span class="token keyword">extends</span> <span class="token class-name">EventEmitter</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">startLoading</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// Load each source</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> source <span class="token keyword">of</span> <span class="token keyword">this</span><span class="token punctuation">.</span>sources<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'gltfModel'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>gltfLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
        source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sourceLoaded</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'texture'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>textureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
        source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sourceLoaded</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>source<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">'cubeTexture'</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>loaders<span class="token punctuation">.</span>cubeTextureLoader<span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span>
        source<span class="token punctuation">.</span>path<span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sourceLoaded</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> file<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token function">sourceLoaded</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span> file</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>items<span class="token punctuation">[</span>source<span class="token punctuation">.</span>name<span class="token punctuation">]</span> <span class="token operator">=</span> file

<span class="token keyword">this</span><span class="token punctuation">.</span>loaded<span class="token operator">++</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>loaded <span class="token operator">===</span> <span class="token keyword">this</span><span class="token punctuation">.</span>toLoad<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Nothing should happen, but now we can listen to the <code spellcheck="false">ready</code> event on the <code spellcheck="false">Resources</code> instance.</p>
<p>In the <code spellcheck="false">World</code> class, retrieve the <code spellcheck="false">Resources</code> instance and listen to the <code spellcheck="false">ready</code> event before instantiating the <code spellcheck="false">Environment</code> class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>resources

<span class="token comment">// Wait for resources</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Where and how you listen to the <code spellcheck="false">ready</code> event is up to you. In this project, we are going to need the resources for every component of the world. But in other projects, you can start showing things to the user while the rest of the experience is loading and, once loaded, you can add the rest of them to the scene.</p>
<p>Check <a target="_blank" href="https://bruno-simon.com">bruno-simon.com</a> as an example. The graphic for the loader shows up almost immediately even if it's 3D. Then, once the rest is loaded, we can click on the button and discover the experience.</p>
<h3>Environment map</h3>
<p>We can now retrieve the <code spellcheck="false">Resources</code> instance in the environment and use the <code spellcheck="false">environmentMapTexture</code> item to create the environment map:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>resources

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setSunLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setEnvironmentMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token function">setEnvironmentMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>intensity <span class="token operator">=</span> <span class="token number">0.4</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>texture <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span>items<span class="token punctuation">.</span>environmentMapTexture
<span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>texture<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding

<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>texture
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/09.png" src="./assets/lessons/26/09.png" width="1792" height="1120" alt="09.png" class="is-loaded"></span></p>
<p>Unfortunately, this won't work because the environment map is added after the cube and we need to inform the cube material that it needs to be updated.</p>
<p>Add an <code spellcheck="false">updateMaterials</code> method to the <code spellcheck="false">environmentMap</code> property which will traverse the scene and update materials if needed and call them right after:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setEnvironmentMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span><span class="token function-variable function">updateMaterials</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span> <span class="token operator">&amp;&amp;</span> child<span class="token punctuation">.</span>material <span class="token keyword">instanceof</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        child<span class="token punctuation">.</span>material<span class="token punctuation">.</span>envMap <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>texture
        child<span class="token punctuation">.</span>material<span class="token punctuation">.</span>envMapIntensity <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>intensity
        child<span class="token punctuation">.</span>material<span class="token punctuation">.</span>needsUpdate <span class="token operator">=</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span><span class="token function">updateMaterials</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/10.png" src="./assets/lessons/26/10.png" width="1792" height="1120" alt="10.png" class="is-loaded"></span></p>
<p>You should see the environment map affecting the dark faces of the cube which now look brighter.</p>
<p>Putting the scene traverse in a separate function will become handy later.</p>
<h3>Floor</h3>
<p>The floor will be a bit easier to add now that we have our <code spellcheck="false">Resources</code> class.</p>
<p>First, load the two textures located in <code spellcheck="false">/textures/dirt/color.jpg</code> and <code spellcheck="false">/textures/dirt/normal.jpg</code> by adding them to the <code spellcheck="false">sources.js</code> file:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>

<span class="token comment">/* ... */</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
name<span class="token operator">:</span> <span class="token string">'grassColorTexture'</span><span class="token punctuation">,</span>
type<span class="token operator">:</span> <span class="token string">'texture'</span><span class="token punctuation">,</span>
path<span class="token operator">:</span> <span class="token string">'textures/dirt/color.jpg'</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
name<span class="token operator">:</span> <span class="token string">'grassNormalTexture'</span><span class="token punctuation">,</span>
type<span class="token operator">:</span> <span class="token string">'texture'</span><span class="token punctuation">,</span>
path<span class="token operator">:</span> <span class="token string">'textures/dirt/normal.jpg'</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>(Do not forget the <code spellcheck="false">,</code> at the end of the previous source).</p>
<p>Create a <code spellcheck="false">Floor</code> class in the <code spellcheck="false">/src/Experience/World/</code> folder:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'../Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Floor</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
<span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>resources
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And then instantiate it in the <code spellcheck="false">World</code> class. Make sure to do this before the <code spellcheck="false">Environment</code> since the environment updates each child of the scene, and we want the floor to be in that scene when this happens:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">import</span> Floor <span class="token keyword">from</span> <span class="token string">'./Floor.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>floor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In this example, we are going to separate each part of the floor into a separate method:</p>
<ul>
<li><code spellcheck="false">setGeometry</code></li>
<li><code spellcheck="false">setTextures</code></li>
<li><code spellcheck="false">setMaterial</code></li>
<li><code spellcheck="false">setMesh</code></li>
</ul>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'../Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Floor</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
<span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>resources

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setTextures</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>For the geometry, we create a <a target="_blank" href="https://threejs.org/docs/?q=CircleGeometry#api/en/geometries/CircleGeometry">CircleGeometry</a>. Don't forget to import <code spellcheck="false">three</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Floor</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setGeometry</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>geometry <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>CircleGeometry</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Before setting the material, we need to do some work on the textures. We need to make them repeat and make sure that the encoding of the color texture is <code spellcheck="false">sRGGEncoding</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Floor</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setTextures</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>textures <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span>items<span class="token punctuation">.</span>grassColorTexture
<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>sRGBEncoding
<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping

<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span>items<span class="token punctuation">.</span>grassNormalTexture
<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>repeat<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">,</span> <span class="token number">1.5</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>wrapS <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
<span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal<span class="token punctuation">.</span>wrapT <span class="token operator">=</span> <span class="token constant">THREE</span><span class="token punctuation">.</span>RepeatWrapping
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Now we can add the material:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Floor</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setMaterial</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>material <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>MeshStandardMaterial</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
map<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>color<span class="token punctuation">,</span>
normalMap<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>textures<span class="token punctuation">.</span>normal
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And finally the mesh without forgetting to make sure it receives a shadow:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Floor</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>mesh <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>geometry<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>material<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x <span class="token operator">=</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">0.5</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">.</span>receiveShadow <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>mesh<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/11.png" src="./assets/lessons/26/11.png" width="1792" height="1120" alt="11.png" class="is-loaded"></span></p>
<p>We now have a nice-looking floor and we can get rid of the box.</p>
<p>Don't mind the missing shadow, we will fix that later.</p>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/12.png" src="./assets/lessons/26/12.png" width="1792" height="1120" alt="12.png" class="is-loaded"></span></p>
<p>No, this is not a pancake.</p>
<h3>Fox</h3>
<p>The process for the fox is very similar. We are going to load the model and add it to the scene.</p>
<p>The difference will be with the animation.</p>
<p>Load the model located in <code spellcheck="false">/models/Fox/glTF/Fox.gltf</code> by adding it to <code spellcheck="false">sources.js</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">[</span>
<span class="token comment">// ...</span>
<span class="token punctuation">{</span>
name<span class="token operator">:</span> <span class="token string">'foxModel'</span><span class="token punctuation">,</span>
type<span class="token operator">:</span> <span class="token string">'gltfModel'</span><span class="token punctuation">,</span>
path<span class="token operator">:</span> <span class="token string">'models/Fox/glTF/Fox.gltf'</span>
<span class="token punctuation">}</span>
<span class="token punctuation">]</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Create a <code spellcheck="false">Fox</code> class in the <code spellcheck="false">/src/Experience/World/</code> folder:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> Experience <span class="token keyword">from</span> <span class="token string">'../Experience.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>experience <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Experience</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>scene
<span class="token keyword">this</span><span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>resources
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And instantiate it in the <code spellcheck="false">World</code> class, but make sure to do it before the <code spellcheck="false">Environment</code> because the environment will update each child of the scene and we want the fox to be in that scene when it does:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">import</span> Fox <span class="token keyword">from</span> <span class="token string">'./Fox.js'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>floor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Floor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>fox <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Fox</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>environment <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Environment</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In the <code spellcheck="false">Fox</code> class we can fetch the resource from the <code spellcheck="false">Resources</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resources<span class="token punctuation">.</span>items<span class="token punctuation">.</span>foxModel
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>The actual model is accessible as an item called <code spellcheck="false">scene</code> within our resource called <code spellcheck="false">foxModel</code>. But, since we are going to need more items within that resource, we save all of it as a property.</p>
<p>In a separate method, save the actual model, scale it, add it to your scene and make sure that it casts shadows. Don't forget to import <code spellcheck="false">three</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> <span class="token constant">THREE</span> <span class="token keyword">from</span> <span class="token string">'three'</span>
<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token function">setModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>model <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>scene
<span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span>scale<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">,</span> <span class="token number">0.02</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    child<span class="token punctuation">.</span>castShadow <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/13.png" src="./assets/lessons/26/13.png" width="1792" height="1120" alt="13.png" class="is-loaded"></span></p>
<p>Here is our fox, but we still need to make the animation work.</p>
<p>Create an <a target="_blank" href="https://threejs.org/docs/?q=mixer#api/en/animation/AnimationMixer">AnimationMixer</a> in the <code spellcheck="false">Fox</code> class and add the first animation from <code spellcheck="false">this.resource.animations</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">setAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token function">setAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>action<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>This is a good start, but if you remember from one of the previous lessons, we need to update that mixer on each frame.</p>
<p>To do that, we are going to update the <code spellcheck="false">World</code> and the <code spellcheck="false">World</code> is going to update the <code spellcheck="false">Fox</code>.</p>
<p>In the <code spellcheck="false">Experience</code> class, update the <code spellcheck="false">World</code>. Make sure to do it right before doing a render:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">//...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>world<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In the <code spellcheck="false">World</code>, update the <code spellcheck="false">Fox</code>, but first, make sure that it exists since the model might not have loaded yet:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">World</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fox<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>fox<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In the <code spellcheck="false">Fox</code> class, retrieve the <code spellcheck="false">Time</code> class because we are going to need the elapsed time, and then create the <code spellcheck="false">update</code> method in which you update the <a target="_blank" href="https://threejs.org/docs/?q=mixer#api/en/animation/AnimationMixer">AnimationMixer</a>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>time

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>

<span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">.</span>delta <span class="token operator">*</span> <span class="token number">0.001</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>
        </p><div class="js-video video">
            <video class="js-element element" width="1792" height="1120" controls="" src="./assets/lessons/26/14.mp4"></video>
            <div class="js-overlay overlay"></div>
            <div class="logo">
                <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.5 66.6" style="enable-background:new 0 0 58.5 66.6;" xml:space="preserve">
                    <path class="face-1" d="M23.1,55.7l16.1-9.3c0,0,0,0,0,0c1.1-0.7,1.8-1.9,1.8-3.1l0.1-19.1L23.1,34.4V55.7z"></path>
                    <path class="face-2" d="M21.3,10L2.9,20.5l18,10.2l18.4-10.5c0,0,0,0-0.1,0l-17.4-10C21.7,10.1,21.5,10.1,21.3,10z"></path>
                    <path class="face-3" d="M1.8,46.7L18,56.6c0,0,0,0,0,0c0.3,0.2,0.5,0.3,0.8,0.3V34.5L0,23.8v19.7C0,44.9,0.7,46.1,1.8,46.7z"></path>
                    <path class="triangle-1" d="M56.8,30.4l-11.4-6.6l-0.1,19.2l11.5-6.7c1-0.6,1.7-1.7,1.7-2.9C58.5,32.1,57.9,31,56.8,30.4z"></path>
                    <path class="triangle-2" d="M0,50.7v12.6c0,1.2,0.6,2.3,1.7,2.9c0.5,0.3,1.1,0.5,1.7,0.5c0.6,0,1.2-0.2,1.7-0.5l10.4-6L0,50.7z"></path>
                    <path class="triangle-3" d="M16.4,7L5.1,0.5c-1-0.6-2.3-0.6-3.4,0C0.6,1.1,0,2.2,0,3.4v13.2L16.4,7z"></path>
                </svg>
            </div>
        </div>
    <p></p>
<p>The fox should be animated.</p>
<p>And it seems that we are done, but we forgot something.</p>
<h3>Debug</h3>
<p>We are missing a very important part, the debug UI.</p>
<h4>Adding the class</h4>
<p>Create a <code spellcheck="false">Debug</code> class in <code spellcheck="false">/src/Experience/Utils/</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Debug</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>

<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In the <code spellcheck="false">Experience</code> class, instantiate it before any other class:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">import</span> Debug <span class="token keyword">from</span> <span class="token string">'./Utils/Debug.js'</span>

<span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">canvas</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Setup</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Debug</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Sizes</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>time <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Time</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Instead of always having the debug UI, we are going to let the user choose to have it.</p>
<p>If the user has accessed the URL with <code spellcheck="false">#debug</code> at the end, they will have the debug UI. Otherwise, no debug UI.</p>
<p>This is handy because most users will access the website without seeing the UI, but users that know what they are doing (like you as the developer) can access the UI without having to rebuild the project.</p>
<p>To test the presence of <code spellcheck="false">#debug</code> in the URL, we can use <code spellcheck="false">window.location.hash</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Debug</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">===</span> <span class="token string">'#debug'</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>If it's the case, we instantiate Dat.GUI in the <code spellcheck="false">ui</code> property. Don't forget to import <code spellcheck="false">dat.gui</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> dat <span class="token keyword">from</span> <span class="token string">'dat.gui'</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Debug</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>active <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash <span class="token operator">===</span> <span class="token string">'#debug'</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>active<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>ui <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">dat<span class="token punctuation">.</span>GUI</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Access the URL by adding <code spellcheck="false">#debug</code> at the end. Be careful, when changing or adding a <code spellcheck="false">#</code> to a URL, most browsers will not refresh automatically and you'll have to do it yourself.</p>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/15.png" src="./assets/lessons/26/15.png" width="1792" height="1120" alt="15.png" class="is-loaded"></span></p>
<p>The debug UI should appear in the top right corner.</p>
<h4>Debug the Fox</h4>
<p>Let's start with the fox. As a little bonus, we are going to create three debug buttons that let us play the three different animations of the model.</p>
<p>First, in the <code spellcheck="false">Fox</code> class, retrieve the <code spellcheck="false">Debug</code> class and, if <code spellcheck="false">debug.active</code> is <code spellcheck="false">true</code>, create a folder:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>debug

<span class="token comment">// Debug</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>active<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span><span class="token string">'fox'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In the <code spellcheck="false">setAnimation</code> method, we are going to make some changes.</p>
<p>First, let's create all three actions available in <code spellcheck="false">this.resource.animations</code> and save them in an <code spellcheck="false">actions</code> property:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>idle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>walking <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Then, we save one of them in the <code spellcheck="false">current</code> property and play it:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">THREE<span class="token punctuation">.</span>AnimationMixer</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>model<span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>idle <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>walking <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>running <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>mixer<span class="token punctuation">.</span><span class="token function">clipAction</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span>animations<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>idle
<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>We should get the same result, but now, we have access to the <code spellcheck="false">walking</code> and <code spellcheck="false">running</code> animations.</p>
<p>When playing a new animation for the model, we want a smooth transition. To do that, we can use one of the many methods available in the <a target="_blank" href="https://threejs.org/docs/?q=actio#api/en/animation/AnimationAction.crossFadeFrom">AnimationAction</a> class.</p>
<p>We are going to use <code spellcheck="false">crossFadeFrom(...)</code>. This method needs to be called on the incoming action, with the previous action as the first parameter and the duration of the transition (in seconds) as the second parameter. We also need to reset and play the new animation.</p>
<p>We are going to put those instructions in a new method. In the <code spellcheck="false">animation</code> property, create a <code spellcheck="false">play</code> method:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function-variable function">play</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>In that <code spellcheck="false">play</code> method, define the previous and the new actions:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function-variable function">play</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> newAction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
<span class="token keyword">const</span> oldAction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Then, reset the new one, play it and do a <code spellcheck="false">crossFadeFrom(...)</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function-variable function">play</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> newAction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
<span class="token keyword">const</span> oldAction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current

newAction<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
newAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
newAction<span class="token punctuation">.</span><span class="token function">crossFadeFrom</span><span class="token punctuation">(</span>oldAction<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Finally, save the new action in the <code spellcheck="false">current</code> property, so that, next time we call our <code spellcheck="false">play</code> function, it will crossfade from that action to the new one:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function-variable function">play</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> newAction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">[</span>name<span class="token punctuation">]</span>
<span class="token keyword">const</span> oldAction <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current

newAction<span class="token punctuation">.</span><span class="token function">reset</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
newAction<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
newAction<span class="token punctuation">.</span><span class="token function">crossFadeFrom</span><span class="token punctuation">(</span>oldAction<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span>actions<span class="token punctuation">.</span>current <span class="token operator">=</span> newAction
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Theoretically, our code should work. But is there a way to test it without adding the buttons to the debug UI?</p>
<p>Remember that we put the experience in a global variable named <code spellcheck="false">experience</code>. This means that, in the console, we can type:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript">window<span class="token punctuation">.</span>experience<span class="token punctuation">.</span>world<span class="token punctuation">.</span>fox<span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">'walking'</span><span class="token punctuation">)</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>
        </p><div class="js-video video">
            <video class="js-element element" width="1792" height="1120" controls="" src="./assets/lessons/26/16.mp4"></video>
            <div class="js-overlay overlay"></div>
            <div class="logo">
                <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.5 66.6" style="enable-background:new 0 0 58.5 66.6;" xml:space="preserve">
                    <path class="face-1" d="M23.1,55.7l16.1-9.3c0,0,0,0,0,0c1.1-0.7,1.8-1.9,1.8-3.1l0.1-19.1L23.1,34.4V55.7z"></path>
                    <path class="face-2" d="M21.3,10L2.9,20.5l18,10.2l18.4-10.5c0,0,0,0-0.1,0l-17.4-10C21.7,10.1,21.5,10.1,21.3,10z"></path>
                    <path class="face-3" d="M1.8,46.7L18,56.6c0,0,0,0,0,0c0.3,0.2,0.5,0.3,0.8,0.3V34.5L0,23.8v19.7C0,44.9,0.7,46.1,1.8,46.7z"></path>
                    <path class="triangle-1" d="M56.8,30.4l-11.4-6.6l-0.1,19.2l11.5-6.7c1-0.6,1.7-1.7,1.7-2.9C58.5,32.1,57.9,31,56.8,30.4z"></path>
                    <path class="triangle-2" d="M0,50.7v12.6c0,1.2,0.6,2.3,1.7,2.9c0.5,0.3,1.1,0.5,1.7,0.5c0.6,0,1.2-0.2,1.7-0.5l10.4-6L0,50.7z"></path>
                    <path class="triangle-3" d="M16.4,7L5.1,0.5c-1-0.6-2.3-0.6-3.4,0C0.6,1.1,0,2.2,0,3.4v13.2L16.4,7z"></path>
                </svg>
            </div>
        </div>
    <p></p>
<p>And you should see the fox starting to walk.</p>
<p>We can now add the debug buttons to our <code spellcheck="false">fox</code> debug folder.</p>
<p>Remember that Dat.GUI needs the value to be available as a property. Unfortunately, we can't just add the <code spellcheck="false">this.animation.play</code> function to Dat.GUI because we also need to send the name of the action to play.</p>
<p>We are going to use a <code spellcheck="false">debugObject</code> and put in three functions with each one calling <code spellcheck="false">this.animation.play</code> with the corresponding parameter:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Fox</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setAnimation</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Debug</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>active<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">const</span> debugObject <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function-variable function">playIdle</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">'idle'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">playWalking</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">'walking'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">playRunning</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token keyword">this</span><span class="token punctuation">.</span>animation<span class="token punctuation">.</span><span class="token function">play</span><span class="token punctuation">(</span><span class="token string">'running'</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">'playIdle'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">'playWalking'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>debugObject<span class="token punctuation">,</span> <span class="token string">'playRunning'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>
        </p><div class="js-video video">
            <video class="js-element element" width="1792" height="1120" controls="" src="./assets/lessons/26/17.mp4"></video>
            <div class="js-overlay overlay"></div>
            <div class="logo">
                <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.5 66.6" style="enable-background:new 0 0 58.5 66.6;" xml:space="preserve">
                    <path class="face-1" d="M23.1,55.7l16.1-9.3c0,0,0,0,0,0c1.1-0.7,1.8-1.9,1.8-3.1l0.1-19.1L23.1,34.4V55.7z"></path>
                    <path class="face-2" d="M21.3,10L2.9,20.5l18,10.2l18.4-10.5c0,0,0,0-0.1,0l-17.4-10C21.7,10.1,21.5,10.1,21.3,10z"></path>
                    <path class="face-3" d="M1.8,46.7L18,56.6c0,0,0,0,0,0c0.3,0.2,0.5,0.3,0.8,0.3V34.5L0,23.8v19.7C0,44.9,0.7,46.1,1.8,46.7z"></path>
                    <path class="triangle-1" d="M56.8,30.4l-11.4-6.6l-0.1,19.2l11.5-6.7c1-0.6,1.7-1.7,1.7-2.9C58.5,32.1,57.9,31,56.8,30.4z"></path>
                    <path class="triangle-2" d="M0,50.7v12.6c0,1.2,0.6,2.3,1.7,2.9c0.5,0.3,1.1,0.5,1.7,0.5c0.6,0,1.2-0.2,1.7-0.5l10.4-6L0,50.7z"></path>
                    <path class="triangle-3" d="M16.4,7L5.1,0.5c-1-0.6-2.3-0.6-3.4,0C0.6,1.1,0,2.2,0,3.4v13.2L16.4,7z"></path>
                </svg>
            </div>
        </div>
    <p></p>
<p>We can now test the different animations right from our debug UI.</p>
<h4>Debug the environment</h4>
<p>For the purposes of this lesson and to make sure that we can use the debug UI, let's add some tweaks to the environment.</p>
<p>In the <code spellcheck="false">Environment</code> class, retrieve the <code spellcheck="false">Debug</code> and, if <code spellcheck="false">active</code>, add a folder:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span>
<span class="token punctuation">{</span>
<span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>debug <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>experience<span class="token punctuation">.</span>debug

<span class="token comment">// Debug</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>active<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">addFolder</span><span class="token punctuation">(</span><span class="token string">'environment'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p class="is-image"><span class="image-inner"><img data-src="./assets/lessons/26/18.png" src="./assets/lessons/26/18.png" width="1792" height="1120" alt="18.png" class="is-loaded"></span></p>
<p>You should see the <code spellcheck="false">environment</code> debug folder.</p>
<p>In the <code spellcheck="false">setEnvironment</code> function, add a tweak for <code spellcheck="false">intensity</code> to that folder and don't forget to call the <code spellcheck="false">this.environmentMap.updateMaterials</code> method that we prepared earlier when the value changes:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setEnvironmentMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Debug</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>active<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">,</span> <span class="token string">'intensity'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'envMapIntensity'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">onChange</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>environmentMap<span class="token punctuation">.</span>updateMaterials<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>
        </p><div class="js-video video">
            <video class="js-element element" width="1792" height="1120" controls="" src="./assets/lessons/26/19.mp4"></video>
            <div class="js-overlay overlay"></div>
            <div class="logo">
                <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.5 66.6" style="enable-background:new 0 0 58.5 66.6;" xml:space="preserve">
                    <path class="face-1" d="M23.1,55.7l16.1-9.3c0,0,0,0,0,0c1.1-0.7,1.8-1.9,1.8-3.1l0.1-19.1L23.1,34.4V55.7z"></path>
                    <path class="face-2" d="M21.3,10L2.9,20.5l18,10.2l18.4-10.5c0,0,0,0-0.1,0l-17.4-10C21.7,10.1,21.5,10.1,21.3,10z"></path>
                    <path class="face-3" d="M1.8,46.7L18,56.6c0,0,0,0,0,0c0.3,0.2,0.5,0.3,0.8,0.3V34.5L0,23.8v19.7C0,44.9,0.7,46.1,1.8,46.7z"></path>
                    <path class="triangle-1" d="M56.8,30.4l-11.4-6.6l-0.1,19.2l11.5-6.7c1-0.6,1.7-1.7,1.7-2.9C58.5,32.1,57.9,31,56.8,30.4z"></path>
                    <path class="triangle-2" d="M0,50.7v12.6c0,1.2,0.6,2.3,1.7,2.9c0.5,0.3,1.1,0.5,1.7,0.5c0.6,0,1.2-0.2,1.7-0.5l10.4-6L0,50.7z"></path>
                    <path class="triangle-3" d="M16.4,7L5.1,0.5c-1-0.6-2.3-0.6-3.4,0C0.6,1.1,0,2.2,0,3.4v13.2L16.4,7z"></path>
                </svg>
            </div>
        </div>
    <p></p>
<p>We can now tweak the environment map intensity and all children of the scene are being updated properly.</p>
<p>Let's do the same with the <code spellcheck="false">sunLight</code> and add tweaks to control the <code spellcheck="false">intensity</code>, <code spellcheck="false">position.x</code>, <code spellcheck="false">position.y</code> and <code spellcheck="false">position.z</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Environment</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">setSunLight</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token comment">// Debug</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>active<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">,</span> <span class="token string">'intensity'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'sunLightIntensity'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token string">'x'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'sunLightX'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'sunLightY'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>debugFolder
    <span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>sunLight<span class="token punctuation">.</span>position<span class="token punctuation">,</span> <span class="token string">'z'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">name</span><span class="token punctuation">(</span><span class="token string">'sunLightZ'</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">min</span><span class="token punctuation">(</span><span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">step</span><span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ...</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>
        </p><div class="js-video video">
            <video class="js-element element" width="1792" height="1120" controls="" src="./assets/lessons/26/20.mp4"></video>
            <div class="js-overlay overlay"></div>
            <div class="logo">
                <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.5 66.6" style="enable-background:new 0 0 58.5 66.6;" xml:space="preserve">
                    <path class="face-1" d="M23.1,55.7l16.1-9.3c0,0,0,0,0,0c1.1-0.7,1.8-1.9,1.8-3.1l0.1-19.1L23.1,34.4V55.7z"></path>
                    <path class="face-2" d="M21.3,10L2.9,20.5l18,10.2l18.4-10.5c0,0,0,0-0.1,0l-17.4-10C21.7,10.1,21.5,10.1,21.3,10z"></path>
                    <path class="face-3" d="M1.8,46.7L18,56.6c0,0,0,0,0,0c0.3,0.2,0.5,0.3,0.8,0.3V34.5L0,23.8v19.7C0,44.9,0.7,46.1,1.8,46.7z"></path>
                    <path class="triangle-1" d="M56.8,30.4l-11.4-6.6l-0.1,19.2l11.5-6.7c1-0.6,1.7-1.7,1.7-2.9C58.5,32.1,57.9,31,56.8,30.4z"></path>
                    <path class="triangle-2" d="M0,50.7v12.6c0,1.2,0.6,2.3,1.7,2.9c0.5,0.3,1.1,0.5,1.7,0.5c0.6,0,1.2-0.2,1.7-0.5l10.4-6L0,50.7z"></path>
                    <path class="triangle-3" d="M16.4,7L5.1,0.5c-1-0.6-2.3-0.6-3.4,0C0.6,1.1,0,2.2,0,3.4v13.2L16.4,7z"></path>
                </svg>
            </div>
        </div>
    <p></p>
<p>We can now tweak the light.</p>
<h3>Destroying</h3>
<p>At some point, you might need to destroy parts of your experience, or even the whole thing. It could be because the animation is done, the player moved to another level, the WebGL isn't visible anymore or maybe the fox ran away.</p>
<p>We could leave things as they are, but that is bad for performances. We have functions being called on each frame, we have textures on the GPU, we have listeners, etc.</p>
<p>In this section, we are going to destroy the whole experience and make sure to dispose of things properly.</p>
<h4>Stopping time and resize events</h4>
<p>First, let's add a destroy method to our <code spellcheck="false">Experience</code> class. This method will stop listening to the <code spellcheck="false">Time</code> and <code spellcheck="false">Sizes</code> events with <code spellcheck="false">off()</code>:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"><span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'tick'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p><code spellcheck="false">off()</code> is part of the <code spellcheck="false">EventEmitter</code> class and will remove every listener attached to the instance.</p>
<p>To test it, we can call <code spellcheck="false">window.experience.destroy()</code> in the browser console.</p>
<p>
        </p><div class="js-video video">
            <video class="js-element element" width="1792" height="1120" controls="" src="./assets/lessons/26/21.mp4"></video>
            <div class="js-overlay overlay"></div>
            <div class="logo">
                <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.5 66.6" style="enable-background:new 0 0 58.5 66.6;" xml:space="preserve">
                    <path class="face-1" d="M23.1,55.7l16.1-9.3c0,0,0,0,0,0c1.1-0.7,1.8-1.9,1.8-3.1l0.1-19.1L23.1,34.4V55.7z"></path>
                    <path class="face-2" d="M21.3,10L2.9,20.5l18,10.2l18.4-10.5c0,0,0,0-0.1,0l-17.4-10C21.7,10.1,21.5,10.1,21.3,10z"></path>
                    <path class="face-3" d="M1.8,46.7L18,56.6c0,0,0,0,0,0c0.3,0.2,0.5,0.3,0.8,0.3V34.5L0,23.8v19.7C0,44.9,0.7,46.1,1.8,46.7z"></path>
                    <path class="triangle-1" d="M56.8,30.4l-11.4-6.6l-0.1,19.2l11.5-6.7c1-0.6,1.7-1.7,1.7-2.9C58.5,32.1,57.9,31,56.8,30.4z"></path>
                    <path class="triangle-2" d="M0,50.7v12.6c0,1.2,0.6,2.3,1.7,2.9c0.5,0.3,1.1,0.5,1.7,0.5c0.6,0,1.2-0.2,1.7-0.5l10.4-6L0,50.7z"></path>
                    <path class="triangle-3" d="M16.4,7L5.1,0.5c-1-0.6-2.3-0.6-3.4,0C0.6,1.1,0,2.2,0,3.4v13.2L16.4,7z"></path>
                </svg>
            </div>
        </div>
    <p></p>
<p>The animation should stop because we are not listening to the <code spellcheck="false">tick</code> event anymore and our <code spellcheck="false">update()</code> function isn't being called.</p>
<h4>Dispose of everything in the scene</h4>
<p>We are now going to traverse the scene and look for the things that we want to dispose.</p>
<p>First, let's use the <code spellcheck="false">traverse()</code> function on the scene:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"> <span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'tick'</span><span class="token punctuation">)</span>

<span class="token comment">// Traverse the whole scene</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>
        </p><div class="js-video video">
            <video class="js-element element" width="1792" height="1120" controls="" src="./assets/lessons/26/22.mp4"></video>
            <div class="js-overlay overlay"></div>
            <div class="logo">
                <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 58.5 66.6" style="enable-background:new 0 0 58.5 66.6;" xml:space="preserve">
                    <path class="face-1" d="M23.1,55.7l16.1-9.3c0,0,0,0,0,0c1.1-0.7,1.8-1.9,1.8-3.1l0.1-19.1L23.1,34.4V55.7z"></path>
                    <path class="face-2" d="M21.3,10L2.9,20.5l18,10.2l18.4-10.5c0,0,0,0-0.1,0l-17.4-10C21.7,10.1,21.5,10.1,21.3,10z"></path>
                    <path class="face-3" d="M1.8,46.7L18,56.6c0,0,0,0,0,0c0.3,0.2,0.5,0.3,0.8,0.3V34.5L0,23.8v19.7C0,44.9,0.7,46.1,1.8,46.7z"></path>
                    <path class="triangle-1" d="M56.8,30.4l-11.4-6.6l-0.1,19.2l11.5-6.7c1-0.6,1.7-1.7,1.7-2.9C58.5,32.1,57.9,31,56.8,30.4z"></path>
                    <path class="triangle-2" d="M0,50.7v12.6c0,1.2,0.6,2.3,1.7,2.9c0.5,0.3,1.1,0.5,1.7,0.5c0.6,0,1.2-0.2,1.7-0.5l10.4-6L0,50.7z"></path>
                    <path class="triangle-3" d="M16.4,7L5.1,0.5c-1-0.6-2.3-0.6-3.4,0C0.6,1.1,0,2.2,0,3.4v13.2L16.4,7z"></path>
                </svg>
            </div>
        </div>
    <p></p>
<p>You should see every child of the scene (even children of children) being logged in the console.</p>
<p>If you refer to the Three.js documentation (<a target="_blank" href="https://threejs.org/docs/#manual/en/introduction/How-to-dispose-of-objects">How to dispose of objects</a>), you will see that we need to dispose of geometries, materials, textures and then specific things like controls, passes, etc.</p>
<p>Here's how we are going to proceed for each child:</p>
<ul>
<li>Test if it's a <a target="_blank" href="https://threejs.org/docs/index.html?q=mesh#api/en/objects/Mesh">Mesh</a>.</li>
<li>Call the <code spellcheck="false">dispose()</code> function on the <code spellcheck="false">geometry</code> property.</li>
<li>Loop through every key of the <code spellcheck="false">material</code> property.</li>
<li>If there is a <code spellcheck="false">dispose()</code> function available on that key, call it.</li>
</ul>
<p>This way, we don't need to test every possible map of the material in order for all the textures and geometries in the scene to be disposed:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"> <span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>sizes<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'resize'</span><span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>time<span class="token punctuation">.</span><span class="token function">off</span><span class="token punctuation">(</span><span class="token string">'tick'</span><span class="token punctuation">)</span>

<span class="token comment">// Traverse the whole scene</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>scene<span class="token punctuation">.</span><span class="token function">traverse</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">child</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
<span class="token punctuation">{</span>
<span class="token comment">// Test if it's a mesh</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>child <span class="token keyword">instanceof</span> <span class="token class-name">THREE<span class="token punctuation">.</span>Mesh</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    child<span class="token punctuation">.</span>geometry<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// Loop through the material properties</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> child<span class="token punctuation">.</span>material<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">const</span> value <span class="token operator">=</span> child<span class="token punctuation">.</span>material<span class="token punctuation">[</span>key<span class="token punctuation">]</span>

        <span class="token comment">// Test if there is a dispose function</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>value <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> value<span class="token punctuation">.</span>dispose <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            value<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>This is a very minimalist way of destroying everything in a scene. You might find that there will be exceptions within specific classes, but our attempt here is to keep things as simple as possible.</p>
<h4>Dispose of the controls</h4>
<p>There is a bit more cleaning up to do. The camera doesn't need to be disposed, but the <a target="_blank" href="https://threejs.org/docs/index.html?q=controls#examples/en/controls/OrbitControls.dispose">OrbitControls</a> do:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"> <span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token keyword">this</span><span class="token punctuation">.</span>camera<span class="token punctuation">.</span>controls<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<h4>Dispose of the Renderer</h4>
<p>The <a target="_blank" href="https://threejs.org/docs/index.html?q=webglre#api/en/renderers/WebGLRenderer.dispose">WebGLRenderer</a> also has a dispose method and we can call it without needing to look too deeply into it.</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"> <span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>renderer<span class="token punctuation">.</span>instance<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>Be careful, if you are using post-processing, you'll need to dispose of the <a target="_blank" href="https://threejs.org/docs/#examples/en/postprocessing/EffectComposer">EffectComposer</a>, its <a target="_blank" href="https://threejs.org/docs/?q=rendertar#api/en/renderers/WebGLRenderTarget">WebGLRenderTarget</a> and any potential passes you are using.</p>
<h4>Dispose of the debug</h4>
<p>We are using Dat.GUI as the Debug UI which is quite easy to destroy. All we need to do is call its <code spellcheck="false">destroy()</code> method, but we need to make sure that the debug is currently active before doing so:</p>
<div class="code-toolbar"><pre contenteditable="" class=" language-javascript"><code spellcheck="false" class=" language-javascript"> <span class="token comment">// ...</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Experience</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>

<span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
<span class="token comment">// ...</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>active<span class="token punctuation">)</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>debug<span class="token punctuation">.</span>ui<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre><div class="toolbar"><div class="toolbar-item"><span>JavaScript</span></div><div class="toolbar-item"><button>Copy</button></div></div></div>
<p>And that's all. You can now call <code spellcheck="false">window.experience.destroy()</code> in the console.</p>
<h4>Warning and further disposing</h4>
<p>As you can see, destroying things is a bit tricky. You'll have to dive into the different components you've used and make sure you are disposing of everything properly.</p>
<p>We didn't remove the <code spellcheck="false">&lt;canvas&gt;</code> and the last frame is still rendered in it, but you can remove from the page if you need.</p>
<p>Be aware that when we stopped listening to the <code spellcheck="false">Sizes</code> and <code spellcheck="false">Time</code> events, those classes will still be listening to native events. This is not a big deal, but if you are a little picky, you can also handle disposing of them as well.</p>
<p>One more thing to acknowledge is that we wrote everything in the same <code spellcheck="false">destroy()</code> method for the sake of simplicity. If you have a more complex project with a lot to destroy, you may want to create a <code spellcheck="false">destroy()</code> method for each class that needs it. This way, the experience would propagate the <code spellcheck="false">destroy()</code> to its children as we did for the <code spellcheck="false">update()</code> and <code spellcheck="false">resize()</code> methods.</p>
<h2>Summary</h2>
<p>Structuring code with modules and classes might look hard and counterproductive at first, but a real-life Three.js project can end up being so huge that you better not have spaghetti code if you want to get that project done right.</p>
<p>Having these separate classes is also great for reusing them with other projects. Most of the <code spellcheck="false">Utils</code> classes we created can be reused without doing anything to them.</p>
<p>Structuring code also creates a good environment in which to work with other developers and limit conflicts. Each developer can work on a specific class.</p>
<p>Many of the decisions we made during this lesson are specific to my personal preferences. You should work on your structure and create a template so that you can start working on a new project more quickly. Don't hesitate to share that structure with others.</p>
</section>
</body>

</html>